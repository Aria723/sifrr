{"version":3,"file":"sifrr.route.min.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':' || r === '*' || r === '**') {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {\n        '*': [],\n        '**': []\n      }, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'].push(match[i + 1]);\n        } else {\n          data[d.substr(1)] = match[i + 1];\n        }\n      });\n    }\n    data.star = data['*'];\n    data.doubleStar = data['**'];\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const Sifrr = window.Sifrr || {\n  Dom: require('@sifrr/dom')\n};\n\nconst template = Sifrr.Dom.html('<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>');\n\nSifrr.Dom.Route =  {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = document.title;\nclass SifrrRoute extends Sifrr.Dom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.push(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.splice(this.constructor.all.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new Sifrr.Dom.Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    this._routeRegex = this._routeRegex || new Sifrr.Dom.Route.RegexPath(this.getAttribute('path'));\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.dataset.sifrrState = JSON.stringify({ route: parsed.data });\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            Sifrr.Dom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n  }\n\n  deactivate() {\n    this.classList.remove('active');\n  }\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.href === this.currentUrl) return;\n    this.all.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.href;\n  }\n\n  static onRouteChange() {}\n}\nSifrrRoute.all = [];\n\nSifrr.Dom.Route.Element = SifrrRoute;\nSifrr.Dom.register(SifrrRoute);\n\ndocument.addEventListener('click', (e) => {\n  if (!(window.history && window.history.pushState)) return;\n  const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n  if (e.metaKey || e.ctrlKey) return;\n  if (!target.matches('a')) return;\n  if (target.host !== window.location.host) return;\n  if (target.target && target.target !== '_self') return;\n\n  e.preventDefault();\n  // replace title with First title if there's no attribute\n  const title = target.getAttribute('title') || firstTitle;\n  const state = {\n    location: target.pathname,\n    title: title\n  };\n  document.title = title;\n  window.history.pushState(state, title, target.pathname);\n  SifrrRoute.refreshAll();\n});\n\nwindow.addEventListener('popstate', (event) => {\n  if (event.state && event.state.title) document.title = event.state.title;\n  // replace title with First title if there's no state title\n  else document.title = firstTitle;\n  SifrrRoute.refreshAll();\n});\n\nmodule.exports = SifrrRoute;\n"],"names":["constructor","path","options","Object","assign","delimiter","_regex","this","RegExp","replace","_dataMap","split","forEach","r","push","test","route","data","match","regex","exec","dataMap","d","i","substr","star","doubleStar","Sifrr","window","Dom","require$$0","template","html","Route","RegexPath","require$$1","firstTitle","document","title","SifrrRoute","Element","onConnect","loaded","all","onDisconnect","splice","indexOf","onAttributeChange","attrName","_routeRegex","getAttribute","refresh","location","pathname","parsed","routeRegex","activate","state","$$","el","dataset","sifrrState","JSON","stringify","deactivate","sifrrElements","filter","value","index","self","tag","load","classList","add","remove","_curl","v","href","currentUrl","sfr","onRouteChange","register","addEventListener","e","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","refreshAll","event"],"mappings":"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"}