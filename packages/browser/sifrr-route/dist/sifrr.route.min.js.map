{"version":3,"file":"sifrr.route.min.js","sources":["../src/sifrr.route.js"],"sourcesContent":["const Sifrr = Sifrr || {};\nSifrr.Dom = require('@sifrr/dom');\nconst template = Sifrr.Dom.html`<style>\n  :host {\n    display: none;\n  }\n  :host(.active) {\n    display: block;\n    opacity: 0;\n    animation: slide 0.3s ease forwards;\n  }\n  @keyframes slide {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n</style>\n<slot></slot>`;\n\nclass RegexPath {\n  static get template() {\n    return template;\n  }\n\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/:[A-Za-z0-9_]{0,}\\?$/g, '([^/]{0,})?')\n      .replace(/:[A-Za-z0-9_]{0,}\\?/g, '([^/]{0,})')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':' || r === '*' || r === '**') {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {\n        star: [],\n        doubleStar: []\n      }, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data.star.push(match[i + 1]);\n        } else if (d === '**') {\n          data.doubleStar.push(match[i + 1]);\n        } else {\n          data[d.substr(1)] = match[i + 1];\n        }\n      });\n    }\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nSifrr.Dom.Event.add('click');\nconst SifrrRoutes = [];\nclass SifrrRoute extends Sifrr.Dom.Element {\n  static observedAttrs() {\n    return ['data-sifrr-path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    SifrrRoutes.push(this);\n  }\n\n  onDisconnect() {\n    SifrrRoutes.splice(SifrrRoutes.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName == 'data-sifrr-path') {\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    this._routeRegex = this._routeRegex || new RegexPath(this.dataset.sifrrPath);\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.dataset.sifrrState = JSON.stringify({ route: parsed.data });\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            Sifrr.Dom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n  }\n\n  deactivate() {\n    this.classList.remove('active');\n  }\n\n  static refreshAll() {\n    SifrrRoutes.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n  }\n\n  static onRouteChange() {}\n}\n\nSifrr.Dom.register(SifrrRoute);\n\ndocument.addEventListener('click', (e) => {\n  const target = e.path ? e.path[0] : e.target;\n  if (!target.matches('a') || target.host !== window.location.host || (target.target && target.target !== '_self')) return;\n  e.preventDefault();\n  const title = target.getAttribute('title') || 'Title';\n  const state = {\n    location: target.pathname,\n    title: title\n  };\n  // replace title with default title for your webapp, maybe your app name\n  document.title = title;\n  history.pushState(state, title, target.pathname);\n  SifrrRoute.refreshAll();\n});\n\nwindow.addEventListener('popstate', (event) => {\n  if (event.state && event.state.title) document.title = event.state.title;\n  SifrrRoute.refreshAll();\n});\n"],"names":["Sifrr","Dom","require$$0","template","html","RegexPath","constructor","path","options","Object","assign","delimiter","_regex","this","RegExp","replace","_dataMap","split","forEach","r","push","test","route","data","star","doubleStar","match","regex","exec","dataMap","d","i","substr","Event","add","SifrrRoutes","SifrrRoute","Element","onConnect","loaded","onDisconnect","splice","indexOf","onAttributeChange","attrName","refresh","_routeRegex","dataset","sifrrPath","location","window","pathname","parsed","routeRegex","activate","state","$$","el","sifrrState","JSON","stringify","deactivate","sifrrElements","filter","value","index","self","tag","load","classList","remove","sfr","onRouteChange","register","document","addEventListener","e","target","matches","host","preventDefault","title","getAttribute","history","pushState","refreshAll","event"],"mappings":"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"}