{"version":3,"file":"sifrr.route.min.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':') {\n        this._dataMap.push(r);\n      } else if (r === '*' || r === '**' || r.match(/\\(.*\\)/)) {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {}, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'] = data['*'] || [];\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'] = data['**'] || [];\n          data['**'].push(match[i + 1]);\n        } else if (d[0] === ':') {\n          data[d.substr(1)] = match[i + 1];\n        } else {\n          data.regexGroups = data.regexGroups || [];\n          data.regexGroups.push(match[i + 1]);\n        }\n      });\n    }\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const SifrrDom = require('@sifrr/dom');\n\nSifrrDom.Route =  {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = window.document.title;\nclass SifrrRoute extends SifrrDom.Element {\n  static get template() {\n    return SifrrDom.template('<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>');\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.push(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.splice(this.constructor.all.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new SifrrDom.Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.state = { route: parsed.data };\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            SifrrDom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n    this.onActivation();\n  }\n\n  onActivation() {}\n\n  deactivate() {\n    this.classList.remove('active');\n    this.onDeactivation();\n  }\n\n  onDeactivation() {}\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.pathname === this.currentUrl) return;\n    this.all.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.pathname;\n  }\n\n  static onRouteChange() {}\n\n  static clickEventListener(e) {\n    if (!(window.history && window.history.pushState)) return false;\n    const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n    if (e.metaKey || e.ctrlKey) return false;\n    if (!target.matches('a')) return false;\n    if (target.host !== window.location.host) return false;\n    if (target.target && target.target !== '_self') return false;\n\n    e.preventDefault();\n    // replace title with First title if there's no attribute\n    const title = target.getAttribute('title') || firstTitle;\n    const state = {\n      pathname: target.pathname,\n      href: target.href,\n      title: title\n    };\n    window.document.title = title;\n    window.history.pushState(state, title, target.href);\n    SifrrRoute.refreshAll();\n\n    return true;\n  }\n\n  static popstateEventListener(e) {\n    if (e.state && e.state.title) window.document.title = e.state.title;\n    // replace title with First title if there's no state title\n    else window.document.title = firstTitle;\n    SifrrRoute.refreshAll();\n  }\n}\nSifrrRoute.all = [];\n\nSifrrDom.Route.Element = SifrrRoute;\nSifrrDom.register(SifrrRoute);\n\nwindow.addEventListener('popstate', SifrrRoute.popstateEventListener);\nwindow.document.addEventListener('click', SifrrRoute.clickEventListener);\n\nmodule.exports = SifrrRoute;\n"],"names":["constructor","path","options","Object","assign","delimiter","_regex","this","RegExp","replace","_dataMap","split","forEach","r","push","match","test","route","data","regex","exec","dataMap","d","i","substr","regexGroups","Route","RegexPath","require$$0","firstTitle","window","document","title","SifrrRoute","SifrrDom","Element","template","onConnect","loaded","all","onDisconnect","splice","indexOf","onAttributeChange","attrName","_routeRegex","getAttribute","refresh","location","pathname","parsed","routeRegex","activate","state","$$","el","deactivate","dataset","sifrrElements","filter","value","index","self","tag","load","classList","add","onActivation","remove","onDeactivation","_curl","v","currentUrl","sfr","onRouteChange","e","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","href","refreshAll","register","addEventListener","popstateEventListener","clickEventListener"],"mappings":"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"}