{"version":3,"file":"sifrr.route.module.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':') {\n        this._dataMap.push(r);\n      } else if (r === '*' || r === '**' || r.match(/\\(.*\\)/)) {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {}, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'] = data['*'] || [];\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'] = data['**'] || [];\n          data['**'].push(match[i + 1]);\n        } else if (d[0] === ':') {\n          data[d.substr(1)] = match[i + 1];\n        } else {\n          data.regexGroups = data.regexGroups || [];\n          data.regexGroups.push(match[i + 1]);\n        }\n      });\n    }\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const SifrrDom = require('@sifrr/dom');\n\nconst Route =  {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = window.document.title;\nclass SifrrRoute extends SifrrDom.Element {\n  static get template() {\n    return SifrrDom.template('<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>');\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.add(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.delete(this);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.state = { route: parsed.data };\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      const sifrrElements = this.dataset.sifrrElements;\n      if (sifrrElements && sifrrElements.indexOf('-') > 0) {\n        try {\n          const elements = JSON.parse(sifrrElements);\n          this.loaded = Promise.all(Object.keys(elements).map(k => SifrrDom.load(k, elements[k])));\n        } catch (e) {\n          this.loaded = Promise.all(sifrrElements.split(',').map(k => SifrrDom.load(k)));\n        }\n      } else {\n        this.loaded = Promise.resolve(true);\n      }\n    }\n    this.classList.add('active');\n    this.onActivate();\n    SifrrDom.Event.trigger(this, 'activate');\n  }\n\n  onActivate() {}\n\n  deactivate() {\n    this.classList.remove('active');\n    this.onDeactivate();\n    SifrrDom.Event.trigger(this, 'deactivate');\n  }\n\n  onDeactivate() {}\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.pathname === this.currentUrl) return;\n    this.all.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.pathname;\n  }\n\n  static onRouteChange() {}\n\n  static clickEventListener(e) {\n    if (!(window.history && window.history.pushState)) return false;\n    const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n    if (e.metaKey ||\n      e.ctrlKey ||\n      !target.matches('a') ||\n      target.host !== window.location.host ||\n      (target.target && target.target !== '_self')) return false;\n\n    e.preventDefault();\n    // replace title with First title if there's no attribute\n    const title = target.getAttribute('title') || firstTitle;\n    const state = {\n      pathname: target.pathname,\n      href: target.href,\n      title: title\n    };\n    window.document.title = title;\n    window.history.pushState(state, title, target.href);\n    SifrrRoute.refreshAll();\n\n    return true;\n  }\n\n  static popstateEventListener(e) {\n    if (e.state && e.state.title) window.document.title = e.state.title;\n    // replace title with First title if there's no state title\n    else window.document.title = firstTitle;\n    SifrrRoute.refreshAll();\n  }\n}\n\nSifrrRoute.all = new Set();\n\nSifrrDom.Event.add('activate');\nSifrrDom.Event.add('deactivate');\nRoute.Element = SifrrRoute;\nSifrrDom.register(SifrrRoute);\n\nwindow.addEventListener('popstate', SifrrRoute.popstateEventListener);\nwindow.document.addEventListener('click', SifrrRoute.clickEventListener);\n\nmodule.exports = Route;\n"],"names":["require$$0","SifrrDom"],"mappings":"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"}