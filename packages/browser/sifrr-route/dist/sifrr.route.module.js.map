{"version":3,"file":"sifrr.route.module.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':' || r === '*' || r === '**') {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {\n        '*': [],\n        '**': []\n      }, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'].push(match[i + 1]);\n        } else {\n          data[d.substr(1)] = match[i + 1];\n        }\n      });\n    }\n    data.star = data['*'];\n    data.doubleStar = data['**'];\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const Sifrr = window.Sifrr || /* istanbul ignore next */ {};\nSifrr.Dom = Sifrr.Dom || /* istanbul ignore next */ require('@sifrr/dom');\n\nSifrr.Dom.Route =  {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = window.document.title;\nclass SifrrRoute extends Sifrr.Dom.Element {\n  static get template() {\n    return Sifrr.Dom.template('<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>');\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.push(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.splice(this.constructor.all.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new Sifrr.Dom.Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.dataset.sifrrState = JSON.stringify({ route: parsed.data });\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            Sifrr.Dom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n  }\n\n  deactivate() {\n    this.classList.remove('active');\n  }\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.href === this.currentUrl) return;\n    this.all.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.href;\n  }\n\n  static onRouteChange() {}\n\n  static clickEventListener(e) {\n    if (!(window.history && window.history.pushState)) return false;\n    const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n    if (e.metaKey || e.ctrlKey) return false;\n    if (!target.matches('a')) return false;\n    if (target.host !== window.location.host) return false;\n    if (target.target && target.target !== '_self') return false;\n\n    e.preventDefault();\n    // replace title with First title if there's no attribute\n    const title = target.getAttribute('title') || firstTitle;\n    const state = {\n      location: target.pathname,\n      title: title\n    };\n    window.document.title = title;\n    window.history.pushState(state, title, target.pathname);\n    SifrrRoute.refreshAll();\n\n    return true;\n  }\n\n  static popstateEventListener(e) {\n    if (e.state && e.state.title) window.document.title = e.state.title;\n    // replace title with First title if there's no state title\n    else window.document.title = firstTitle;\n    SifrrRoute.refreshAll();\n  }\n}\nSifrrRoute.all = [];\n\nSifrr.Dom.Route.Element = SifrrRoute;\nSifrr.Dom.register(SifrrRoute);\n\nwindow.addEventListener('popstate', SifrrRoute.popstateEventListener);\nwindow.document.addEventListener('click', SifrrRoute.clickEventListener);\n\nmodule.exports = SifrrRoute;\n"],"names":["RegexPath","constructor","path","options","Object","assign","delimiter","regex","_regex","RegExp","replace","dataMap","_dataMap","split","forEach","r","push","test","route","data","match","exec","d","i","substr","star","doubleStar","Sifrr","window","Dom","require$$0","Route","require$$1","firstTitle","document","title","SifrrRoute","Element","template","observedAttrs","onConnect","loaded","all","onDisconnect","splice","indexOf","onAttributeChange","attrName","_routeRegex","getAttribute","refresh","routeRegex","location","pathname","parsed","activate","state","$$","el","dataset","sifrrState","JSON","stringify","deactivate","sifrrElements","tags","filter","value","index","self","tag","load","classList","add","remove","currentUrl","_curl","v","refreshAll","href","sfr","onRouteChange","clickEventListener","e","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","popstateEventListener","register","addEventListener"],"mappings":"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"}