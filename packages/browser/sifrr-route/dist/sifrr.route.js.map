{"version":3,"file":"sifrr.route.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':' || r === '*' || r === '**') {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {\n        '*': [],\n        '**': []\n      }, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'].push(match[i + 1]);\n        } else {\n          data[d.substr(1)] = match[i + 1];\n        }\n      });\n    }\n    data.star = data['*'];\n    data.doubleStar = data['**'];\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const template = Sifrr.Dom.html`<style>\n  :host {\n    display: none;\n  }\n  :host(.active) {\n    display: block;\n    opacity: 0;\n    animation: slide 0.3s ease forwards;\n  }\n  @keyframes slide {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n</style>\n<slot></slot>`;\n\nSifrr.Dom.Route =  {\n  RegexPath: require('./regexpath')\n};\n\nSifrr.Dom.Event.add('click');\nconst SifrrRoutes = [];\nclass SifrrRoute extends Sifrr.Dom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['data-sifrr-path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    SifrrRoutes.push(this);\n  }\n\n  onDisconnect() {\n    SifrrRoutes.splice(SifrrRoutes.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName == 'data-sifrr-path') {\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    this._routeRegex = this._routeRegex || new Sifrr.Dom.Route.RegexPath(this.dataset.sifrrPath);\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.dataset.sifrrState = JSON.stringify({ route: parsed.data });\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            Sifrr.Dom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n  }\n\n  deactivate() {\n    this.classList.remove('active');\n  }\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.href === this.currentUrl) return;\n    SifrrRoutes.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.href;\n  }\n\n  static onRouteChange() {}\n}\n\nSifrr.Dom.Route.Element = SifrrRoute;\nSifrr.Dom.register(SifrrRoute);\n\ndocument.addEventListener('click', (e) => {\n  if (!(window.history && window.history.pushState)) return;\n  const target = e.composedPath ? e.composedPath()[0] : e.target;\n  if (e.metaKey || e.ctrlKey) return;\n  if (!target.matches('a') || target.host !== window.location.host || (target.target && target.target !== '_self')) return;\n  e.preventDefault();\n  const title = target.getAttribute('title') || 'Title';\n  const state = {\n    location: target.pathname,\n    title: title\n  };\n  // replace title with default title for your webapp, maybe your app name\n  document.title = title;\n  window.history.pushState(state, title, target.pathname);\n  SifrrRoute.refreshAll();\n});\n\nwindow.addEventListener('popstate', (event) => {\n  if (event.state && event.state.title) document.title = event.state.title;\n  SifrrRoute.refreshAll();\n});\n"],"names":["RegexPath","constructor","path","options","Object","assign","delimiter","regex","_regex","RegExp","replace","dataMap","_dataMap","split","forEach","r","push","test","route","data","match","exec","d","i","substr","star","doubleStar","template","Sifrr","Dom","html","Route","require$$0","Event","add","SifrrRoutes","SifrrRoute","Element","observedAttrs","onConnect","loaded","onDisconnect","splice","indexOf","onAttributeChange","attrName","refresh","routeRegex","_routeRegex","dataset","sifrrPath","location","window","pathname","parsed","activate","state","$$","el","sifrrState","JSON","stringify","deactivate","sifrrElements","tags","filter","value","index","self","tag","load","classList","remove","currentUrl","_curl","v","refreshAll","href","sfr","onRouteChange","register","document","addEventListener","e","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","title","getAttribute","event"],"mappings":"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"}