{"version":3,"file":"sifrr.route.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex = this._regex || new RegExp('^' + this.path\n      .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n      .replace(/\\*\\*/g, '(.{0,})')\n      .replace(/\\*/g, '([^/]{0,})')\n      .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') + '$');\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach((r) => {\n      if (r[0] === ':') {\n        this._dataMap.push(r);\n      } else if (r === '*' || r === '**' || r.match(/\\(.*\\)/)) {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {}, match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'] = data['*'] || [];\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'] = data['**'] || [];\n          data['**'].push(match[i + 1]);\n        } else if (d[0] === ':') {\n          data[d.substr(1)] = match[i + 1];\n        } else {\n          data.regexGroups = data.regexGroups || [];\n          data.regexGroups.push(match[i + 1]);\n        }\n      });\n    }\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const SifrrDom = require('@sifrr/dom');\n\nconst Route =  {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = window.document.title;\nclass SifrrRoute extends SifrrDom.Element {\n  static get template() {\n    return SifrrDom.template('<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>');\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.push(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.splice(this.constructor.all.indexOf(this), 1);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach((el) => {\n        el.state = { route: parsed.data };\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      this.loaded = true;\n      if (this.dataset.sifrrElements && this.dataset.sifrrElements.indexOf('-') > 0) {\n        const tags = this.dataset.sifrrElements.split(',');\n        tags\n          .filter((value, index, self) => self.indexOf(value) === index)\n          .forEach((tag) => {\n            SifrrDom.load(tag);\n          });\n      }\n    }\n    this.classList.add('active');\n    SifrrDom.Event.trigger(this, 'activate');\n    this.onActivation();\n  }\n\n  onActivation() {}\n\n  deactivate() {\n    this.classList.remove('active');\n    SifrrDom.Event.trigger(this, 'deactivate');\n    this.onDeactivation();\n  }\n\n  onDeactivation() {}\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.pathname === this.currentUrl) return;\n    this.all.forEach((sfr) => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.pathname;\n  }\n\n  static onRouteChange() {}\n\n  static clickEventListener(e) {\n    if (!(window.history && window.history.pushState)) return false;\n    const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n    if (e.metaKey ||\n      e.ctrlKey ||\n      !target.matches('a') ||\n      target.host !== window.location.host ||\n      (target.target && target.target !== '_self')) return false;\n\n    e.preventDefault();\n    // replace title with First title if there's no attribute\n    const title = target.getAttribute('title') || firstTitle;\n    const state = {\n      pathname: target.pathname,\n      href: target.href,\n      title: title\n    };\n    window.document.title = title;\n    window.history.pushState(state, title, target.href);\n    SifrrRoute.refreshAll();\n\n    return true;\n  }\n\n  static popstateEventListener(e) {\n    if (e.state && e.state.title) window.document.title = e.state.title;\n    // replace title with First title if there's no state title\n    else window.document.title = firstTitle;\n    SifrrRoute.refreshAll();\n  }\n}\n\nSifrrRoute.all = [];\n\nSifrrDom.Event.add('activate');\nSifrrDom.Event.add('deactivate');\nRoute.Element = SifrrRoute;\nSifrrDom.register(SifrrRoute);\n\nwindow.addEventListener('popstate', SifrrRoute.popstateEventListener);\nwindow.document.addEventListener('click', SifrrRoute.clickEventListener);\n\nmodule.exports = Route;\n"],"names":["RegexPath","constructor","path","options","Object","assign","delimiter","regex","_regex","RegExp","replace","dataMap","_dataMap","split","forEach","r","push","match","test","route","data","exec","d","i","substr","regexGroups","Route","require$$0","firstTitle","window","document","title","SifrrRoute","SifrrDom","Element","template","observedAttrs","onConnect","loaded","all","onDisconnect","splice","indexOf","onAttributeChange","attrName","_routeRegex","getAttribute","refresh","routeRegex","location","pathname","parsed","activate","state","$$","el","deactivate","dataset","sifrrElements","tags","filter","value","index","self","tag","load","classList","add","Event","trigger","onActivation","remove","onDeactivation","currentUrl","_curl","v","refreshAll","sfr","onRouteChange","clickEventListener","e","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","href","popstateEventListener","register","addEventListener"],"mappings":"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"}