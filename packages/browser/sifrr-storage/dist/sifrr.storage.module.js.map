{"version":3,"file":"sifrr.storage.module.js","sources":["../src/utils/json.js","../src/storages/storage.js","../src/storages/indexeddb.js","../src/storages/websql.js","../src/storages/localstorage.js","../src/storages/cookies.js","../src/storages/jsonstorage.js","../src/storages.js","../src/sifrr.storage.js"],"sourcesContent":["class Json {\n  static parse(data) {\n    let ans = {};\n    if (typeof data == 'string') {\n      try {\n        ans = JSON.parse(data);\n      } catch(e) {\n        return data;\n      }\n      return this.parse(ans);\n    } else if (Array.isArray(data)) {\n      ans = [];\n      data.forEach((v, i) => {\n        ans[i] = this.parse(v);\n      });\n    } else if (typeof data == 'object') {\n      if (data === null) return null;\n      for (const k in data) {\n        ans[k] = this.parse(data[k]);\n      }\n    } else {\n      return data;\n    }\n    return ans;\n  }\n\n  static stringify(data) {\n    if (typeof data == 'string') {\n      return data;\n    } else {\n      return JSON.stringify(data);\n    }\n  }\n}\n\nmodule.exports = Json;\n","const JsonExt = require('../utils/json');\n\nclass Storage {\n  constructor(options = {}) {\n    this._options = options;\n  }\n\n  _parseKeyValue(key, value) {\n    let jsonConstructor = {}.constructor;\n    if (typeof value === 'undefined') {\n      if (Array.isArray(key)) {\n        return key;\n      } else if (typeof key === 'string') {\n        return [key];\n      } else if (key.constructor === jsonConstructor) {\n        return key;\n      } {\n        throw Error('Invalid Key');\n      }\n    } else if (typeof key === 'string') {\n      let ans = {};\n      ans[key] = value;\n      return ans;\n    } else {\n      throw Error('Invalid Key');\n    }\n  }\n\n  _select(keys) {\n    return this.data().then((data) => {\n      let ans = {};\n      keys.forEach((key) => ans[key] = data[key]);\n      return ans;\n    });\n  }\n\n  _upsert(data) {\n    let table = this.table;\n    for (let key in data) {\n      table[key] = data[key];\n    }\n    this.table = table;\n  }\n\n  _delete(keys) {\n    let table = this.table;\n    keys.forEach((key) => delete table[key]);\n    this.table = table;\n  }\n\n  _clear() {\n    this.table = {};\n  }\n\n  _isEqual(options, type) {\n    if (this.tableName == options.name + options.version && this.type == type) { return true; }\n    else { return false; }\n  }\n\n  get tableName() {\n    return this.name + this.version;\n  }\n\n  get name() {\n    return this._options.name;\n  }\n\n  get version() {\n    return this._options.version;\n  }\n\n  get description() {\n    return this._options.description;\n  }\n\n  get type() {\n    return this.constructor.type;\n  }\n\n  isSupported(force = true) {\n    if (force && (typeof window === 'undefined' || typeof document === 'undefined')) { return true; }\n    else if (window && typeof this.store !== 'undefined') { return true; }\n    else { return false; }\n  }\n\n  all() {\n    return this.data();\n  }\n\n  data() {\n    return Promise.resolve(this._parsedData());\n  }\n\n  select(key) {\n    return Promise.resolve(this._select(this._parseKeyValue(key)));\n  }\n\n  insert(key, value) {\n    return Promise.resolve(this._upsert(this._parseKeyValue(key, value)));\n  }\n\n  update(key, value) {\n    return Promise.resolve(this._upsert(this._parseKeyValue(key, value)));\n  }\n\n  upsert(key, value) {\n    return Promise.resolve(this._upsert(this._parseKeyValue(key, value)));\n  }\n\n  delete(key) {\n    return Promise.resolve(this._delete(this._parseKeyValue(key)));\n  }\n\n  deleteAll() {\n    return Promise.resolve(this._clear());\n  }\n\n  clear() {\n    return Promise.resolve(this._clear());\n  }\n\n  static stringify(data) {\n    return JsonExt.stringify(data);\n  }\n\n  static parse(data) {\n    return JsonExt.parse(data);\n  }\n}\n\nmodule.exports = Storage;\n","const Storage = require('./storage');\n\nclass IndexedDB extends Storage {\n  constructor(options) {\n    super(options);\n  }\n\n  _parsedData() {\n    return this._tx('readonly', 'getAll').then((result) => this.parse(result));\n  }\n\n  _select(keys) {\n    let ans = {};\n    let promises = [];\n    keys.forEach((key) => promises.push(this._tx('readonly', 'get', key).then((r) => ans[key] = this.parse(r))));\n    return Promise.all(promises).then(() => ans);\n  }\n\n  _upsert(data) {\n    let promises = [];\n    for (let key in data) {\n      let promise = this._tx('readonly', 'get', key).then((oldResult) => {\n        if (oldResult && oldResult.key == key) {\n          return this._tx('readwrite', 'put', { key: key, value: data[key] });\n        } else {\n          return this._tx('readwrite', 'add', { key: key, value: data[key] });\n        }\n      });\n      promises.push(promise);\n    }\n    return Promise.all(promises);\n  }\n\n  _delete(keys) {\n    let promises = [];\n    keys.forEach((key) => promises.push(this._tx('readwrite', 'delete', key)));\n    return Promise.all(promises);\n  }\n\n  _clear() {\n    return this._tx('readwrite', 'clear');\n  }\n\n  _tx(scope, fn, params) {\n    let me = this;\n    return this.createStore(me.tableName).then((db) => {\n      return new Promise((resolve, reject) => {\n        let tx = db.transaction(me.tableName, scope).objectStore(me.tableName);\n        let request = tx[fn].call(tx, params);\n        request.onsuccess = (event) =>  resolve(event.target.result);\n        request.onerror = (event) => reject(event.error);\n      });\n    });\n  }\n\n  get store() {\n    return window.indexedDB;\n  }\n\n  createStore(table) {\n    return new Promise((resolve, reject) => {\n      const request = this.store.open(table, 1);\n      request.onupgradeneeded = (event) => {\n        let db = event.target.result;\n        db.createObjectStore(table, { keyPath: 'key' });\n      };\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  parse(data) {\n    let ans = {};\n    if (Array.isArray(data)) {\n      data.forEach((row) => {\n        ans[row.key] = row.value;\n      });\n    } else if (data && data.value) {\n      return data.value;\n    } else {\n      return undefined;\n    }\n    return ans;\n  }\n\n  static get type() {\n    return 'indexeddb';\n  }\n}\n\nmodule.exports = IndexedDB;\n","const Storage = require('./storage');\n\nclass WebSQL extends Storage {\n  constructor(options) {\n    super(options);\n    this.createStore();\n  }\n\n  _parsedData() {\n    let me = this;\n    return new Promise((resolve) => {\n      this.store.transaction(function (tx) {\n        tx.executeSql(`SELECT * FROM ${me.tableName}`, [], (txn, results) => {\n          resolve(me.parse(results));\n        });\n      });\n    });\n  }\n\n  _select(keys) {\n    let me = this;\n    let q = keys.map(() => '?').join(', ');\n    // Need to give array for ? values in executeSql's 2nd argument\n    return this.execSql(`SELECT key, value FROM ${me.tableName} WHERE key in (${q})`, keys);\n  }\n\n  _upsert(data) {\n    let table = this.tableName;\n    this.store.transaction((tx) => {\n      for (let key in data) {\n        tx.executeSql(`INSERT OR IGNORE INTO ${table}(key, value) VALUES (?, ?)`, [key, data[key]]);\n        tx.executeSql(`UPDATE ${table} SET value = ? WHERE key = ?`, [this.constructor.stringify(data[key]), key]);\n      }\n    });\n  }\n\n  _delete(keys) {\n    let table = this.tableName;\n    let q = keys.map(() => '?').join(', ');\n    return this.execSql(`DELETE FROM ${table} WHERE key in (${q})`, keys);\n  }\n\n  _clear() {\n    let table = this.tableName;\n    return this.execSql(`DELETE FROM ${table}`);\n  }\n\n  get store() {\n    return window.openDatabase('bs', 1, this._options.description, this._options.size);\n  }\n\n  createStore() {\n    let table = this.tableName;\n    if (typeof window == 'undefined') return;\n    return this.execSql(`CREATE TABLE IF NOT EXISTS ${table} (key unique, value)`);\n  }\n\n  execSql(query, args = []) {\n    let me = this;\n    return new Promise((resolve) => {\n      me.store.transaction(function (tx) {\n        tx.executeSql(query, args, (txn, results) => {\n          resolve(me.parse(results));\n        });\n      });\n    });\n  }\n\n  parse(results) {\n    let ans = {};\n    let len = results.rows.length, i;\n    for (i = 0; i < len; i++) {\n      ans[results.rows.item(i).key] = this.constructor.parse(results.rows.item(i).value);\n    }\n    return ans;\n  }\n\n  static get type() {\n    return 'websql';\n  }\n}\n\nmodule.exports = WebSQL;\n","const Storage = require('./storage');\n\nclass LocalStorage extends Storage {\n  constructor(options) {\n    super(options);\n  }\n\n  _parsedData() {\n    return this.table;\n  }\n\n  get table() {\n    return this.constructor.parse(this.store.getItem(this.tableName) || {});\n  }\n\n  set table(value) {\n    this.store.setItem(this.tableName, this.constructor.stringify(value));\n  }\n\n  get store() {\n    return window.localStorage;\n  }\n\n  static get type() {\n    return 'localstorage';\n  }\n}\n\nmodule.exports = LocalStorage;\n","const Storage = require('./storage');\n\nclass Cookies extends Storage {\n  constructor(options) {\n    super(options);\n  }\n\n  _parsedData() {\n    return this.table;\n  }\n\n  get table() {\n    let result = this.store, ans = {};\n    result.split('; ').forEach((value) => {\n      let [k, v] = value.split('=');\n      ans[k] = this.constructor.parse(v);\n    });\n    return ans[this.tableName] || {};\n  }\n\n  set table(value) {\n    document.cookie = `${this.tableName}=${Storage.stringify(value)}; path=/`;\n  }\n\n  get store() {\n    return document.cookie;\n  }\n\n  static get type() {\n    return 'cookies';\n  }\n}\n\nmodule.exports = Cookies;\n","const Storage = require('./storage');\n\nclass JsonStorage extends Storage {\n  constructor(options, data = {}) {\n    super(options);\n    this._upsert(this.constructor.parse(data));\n  }\n\n  _parsedData() {\n    return this._table;\n  }\n\n  get store() {\n    return this._table;\n  }\n\n  get table() {\n    return this._table || {};\n  }\n\n  set table(value) {\n    this._table = value;\n  }\n\n  static get type() {\n    return 'jsonstorage';\n  }\n}\n\nmodule.exports = JsonStorage;\n","const IndexedDB = require('./storages/indexeddb');\nconst WebSQL = require('./storages/websql');\nconst LocalStorage = require('./storages/localstorage');\nconst Cookies = require('./storages/cookies');\nconst JsonStorage = require('./storages/jsonstorage');\n\nlet storages = {};\nstorages[IndexedDB.type] = IndexedDB;\nstorages[WebSQL.type] = WebSQL;\nstorages[LocalStorage.type] = LocalStorage;\nstorages[Cookies.type] = Cookies;\nstorages[JsonStorage.type] = JsonStorage;\n\nmodule.exports = storages;\n","const storages = require('./storages');\nconst JsonStorage = require('./storages/jsonstorage');\n\nclass SifrrStorage {\n  constructor(options) {\n    if (typeof options === 'string') options = { priority: [options] }; else options = options || {};\n    this._options = Object.assign(this.constructor.defaultOptions, options);\n    return this.storage;\n  }\n\n  get storage() {\n    let storage = this.supportedStore();\n    if (typeof storage === 'undefined') throw Error('No available storage supported in this browser');\n    let matchingInstance = this.constructor._matchingInstance(this._options, storage.type);\n    if (matchingInstance) { return matchingInstance; }\n    else {\n      let storageInstance = new storage(this._options);\n      this.constructor._add(storageInstance);\n      return storageInstance;\n    }\n  }\n\n  get priority() {\n    return this._options.priority.concat(['indexeddb', 'websql', 'localstorage', 'cookies', 'jsonstorage']);\n  }\n\n  supportedStore() {\n    for (let i = 0; i < this.priority.length; i++) {\n      let store = this.constructor.availableStores[this.priority[i]];\n      if (store && new store(this._options).isSupported()) return store;\n    }\n  }\n\n  static _matchingInstance(options, type) {\n    let allInstances = this.all, i;\n    let length = allInstances.length;\n    for (i = 0; i < length; i++) {\n      if (allInstances[i]._isEqual(options, type)) return allInstances[i];\n    }\n    return false;\n  }\n\n  static _add(instance) {\n    this._all = this._all || [];\n    this._all.push(instance);\n  }\n\n  static get availableStores() {\n    return storages;\n  }\n\n  static get defaultOptions() {\n    return {\n      priority: [],\n      name: 'SifrrStorage',\n      version: 1,\n      description: 'Sifrr Storage',\n      size: 5 * 1024 * 1024\n    };\n  }\n\n  static get all() {\n    return this._all || [];\n  }\n\n  static json(data) {\n    return new JsonStorage({}, data);\n  }\n}\n\nmodule.exports = SifrrStorage;\n"],"names":["Json","parse","data","ans","JSON","e","Array","isArray","forEach","v","i","k","stringify","Storage","constructor","options","_options","_parseKeyValue","key","value","jsonConstructor","Error","_select","keys","then","_upsert","table","_delete","_clear","_isEqual","type","tableName","name","version","description","isSupported","force","window","document","store","all","Promise","resolve","_parsedData","select","insert","update","upsert","delete","deleteAll","clear","JsonExt","IndexedDB","_tx","result","promises","push","r","promise","oldResult","scope","fn","params","me","createStore","db","reject","tx","transaction","objectStore","request","call","onsuccess","event","target","onerror","error","indexedDB","open","onupgradeneeded","createObjectStore","keyPath","row","undefined","WebSQL","executeSql","txn","results","q","map","join","execSql","openDatabase","size","query","args","len","rows","length","item","LocalStorage","getItem","setItem","localStorage","Cookies","split","cookie","JsonStorage","_table","storages","SifrrStorage","priority","Object","assign","defaultOptions","storage","supportedStore","matchingInstance","_matchingInstance","storageInstance","_add","concat","availableStores","allInstances","instance","_all","json"],"mappings":"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"}