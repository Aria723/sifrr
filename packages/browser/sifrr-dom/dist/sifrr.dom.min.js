!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.Sifrr=t.Sifrr||{},t.Sifrr.Dom=e())}(this,function(){"use strict";var t=class{static toVDOM(t,e=!1,s=!1){if(NodeList.prototype.isPrototypeOf(t)||Array.isArray(t)){let n=[];return t.forEach(t=>n.push(SFComponent.toVDOM(t,e,s))),n}if(3===t.nodeType||"string"==typeof t){const e=t.nodeValue||t;return{tag:"#text",data:e,state:e.indexOf("${")>-1||s}}{let n=!1;const r=t.attributes||{},a=r.length,o=[];for(let t=0;t<a;t++)o[r[t].name]={value:r[t].value,state:r[t].value.indexOf("${")>-1||s},o[r[t].name].state&&(n=!0);let i={tag:t.nodeName,attrs:o,children:SFComponent.toVDOM(t.childNodes,e,s)};return e&&(i.dom=t),i.children.forEach(t=>{t.state&&(n=!0)}),i.state=s||n,i}}static twoWayBind(t){const e=t.composedPath()?t.composedPath()[0]:t.target;if(e.setAttribute("value",e.value),!e.dataset||!e.dataset.bindTo)return;let s,n,r,a,o,i=e.getRootNode(),l=i;e.value||(s=l.getSelection().getRangeAt(0).cloneRange(),[n,r,a,o]=[s.startContainer,s.startOffset,s.endContainer,s.endOffset]),i=i.host;let c={};c[e.dataset.bindTo]="string"==typeof e.value?e.value:e.innerHTML.trim().replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(input|link|img|br|hr|col|keygen)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"),i.state=c,e.value||(s.setStart(n,r),s.setEnd(a,o),l.getSelection().removeAllRanges(),l.getSelection().addRange(s))}static updateState(t){}};var e=class{static parse(t){let e={};if("string"==typeof t){try{e=JSON.parse(t)}catch(e){return t}return this.parse(e)}if(Array.isArray(t))e=[],t.forEach((t,s)=>{e[s]=this.parse(t)});else{if("object"!=typeof t)return t;for(const s in t)e[s]=this.parse(t[s])}return e}static stringify(t){return"string"==typeof t?t:JSON.stringify(t)}};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s,n=(function(t,e){var s;t.exports=(s=class{constructor(t,e,s){this.type=t,this._options=s,this._url=e}get response(){return window.fetch(this.url,this.options).then(t=>{let e,s=t.headers.get("content-type");if(e=s&&s.includes("application/json")?t.json():t.text(),t.ok)return e;{let s=Error(t.statusText);throw s.response=e,s}})}get url(){let t=delete this._options.params;return t&&Object.keys(t).length>0?this._url+"?"+Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&"):this._url}get options(){return Object.assign(this._options,{method:this.type,headers:Object.assign({accept:"application/json"},this._options.headers||{}),mode:"cors",redirect:"follow"})}},class{static get(t,e={}){return new s("GET",t,e).response}static post(t,e={}){return new s("POST",t,e).response}static put(t,e={}){return new s("PUT",t,e).response}static delete(t,e={}){return new s("DELETE",t,e).response}static file(t,e={}){return e.headers=e.headers||{},e.headers.accept=e.headers.accept||"*/*",new s("GET",t,e).response}})}(s={exports:{}},s.exports),s.exports);var r=class extends window.HTMLElement{static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs||[])}static get templateUrl(){return`/elements/${this.elementName.split("-").join("/")}.html`}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get template(){return this._template=this._template||this.getTemplate(),this._template}static getTemplate(){return n.file(this.templateUrl)}constructor(){super();let e=this;this.constructor.template.then(s=>{e.attachShadow({mode:"open"}).appendChild(s.content.cloneNode(!0)),e.vdom=t.toVDOM(s.content.cloneNode(!0))}),this._state=this.constructor.defaultState||{}}attributeChangedCallback(t,s,n){"data-sifrr-state"===t&&(this.state=e.parse(n))}connectedCallback(){this.state=e.parse(this.dataset.sifrrState)||{},this.shadowRoot?this.shadowRoot.addEventListener("change",t.twoWayBind):this.addEventListener("change",t.twoWayBind)}disconnectedCallback(){}get state(){return this._state||{}}set state(e){this._lastState=this.state,Object.assign(this._state,e),t.updateState(this)}isSifrr(t=null){return!t||t==this.constructor.elementName}clearState(){this._lastState=this.state,this._state={},t.updateState(this)}};let a={elements:{}};return a.Element=r,a.Vdom=t,a.register=function(t){const e=t.elementName;if(e)if(window.customElements.get(e))console.log(`Error creating Element: ${e} - Custom Element with this name is already defined.`);else if(e.indexOf("-")<1)console.log(`Error creating Element: ${e} - Custom Element name must have one dash '-'`);else try{return window.customElements.define(e,t),a.elements[e]=t,!0}catch(t){return console.log(`Error creating Custom Element: ${e} - ${t}`),!1}else console.log("Error creating Custom Element: No name given.");return!1},a});
