/*! Sifrr.Dom v0.1.0-alpha - sifrr project - 2018/12/13 14:58:03 UTC */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.Sifrr=t.Sifrr||{},t.Sifrr.Dom=e())}(this,function(){"use strict";class t{constructor(e,r){this.baseElement=e,this.html=r,this.originalVdom=t.toVdom(r)}updateState(){}newVdom(){}static toVdom(e){if(Array.isArray(e)){let r=[];for(;e.length;)r.push(t.toVdom(e.shift()));return r}if(3===e.nodeType)return{tag:"#text",data:e.nodeValue,dom:e};const r=e.attributes||[],n=r.length;let a={};for(let t=0;t<n;t++)a[r[t].name]=r[t].value;return{tag:e.nodeName,attrs:a,children:t.toVdom(Array.prototype.slice.call(e.childNodes)),dom:e}}static toHtml(e){if(!e)return e;if(Array.isArray(e)){let r=[];for(;e.length;)r.push(t.toHtml(e.shift()));return r}if(e.dom)return e.dom;let r;switch(e.tag){case"#text":r=document.createTextNode(e.data);break;case"#comment":r=document.createComment("comment");break;default:r=document.createElement(e.tag);for(let t in e.attrs)r.setAttribute(t,e.attrs[t]);r.append(...t.toHtml(e.children))}return r}}var e=t;const r={sifrrNode:window.document.createElement("sifrr-node"),createStateMap:function(t){let n=[],a=[];if(Array.isArray(t)){for(;t.length;){const e=r.createStateMap(t.shift());Array.prototype.push.apply(n,e.nodes),Array.prototype.push.apply(a,e.attributes)}return{nodes:n,attributes:a}}if(3===t.nodeType){const s=t.nodeValue;if(s.indexOf("${")>-1)if("true"==t.parentNode.contentEditable||"TEXTAREA"==t.parentNode.nodeName||"STYLE"==t.parentNode.nodeName||t.parentNode.dataset&&"true"==t.parentNode.dataset.sifrrHtml)n.push({tag:t.parentNode.nodeName,data:t.parentNode.innerHTML,dom:t.parentNode}),t.parentNode.originalVdom=e.toVdom(t.parentNode);else{let e=r.sifrrNode.cloneNode();const a=t.cloneNode();e.appendChild(a),e.originalVdom={children:[{tag:"#text",data:s,dom:a}]},t.replaceWith(e),n.push({tag:"sifrr-node",data:s,dom:e})}return{nodes:n,attributes:a}}const s=t.attributes||[],o=s.length;for(let e=0;e<o;e++){const r=s[e];r.value.indexOf("${")>-1&&a.push({name:r.name,value:r.value,dom:t})}const i=r.createStateMap(Array.prototype.slice.call(t.childNodes));return Array.prototype.push.apply(n,i.nodes),Array.prototype.push.apply(a,i.attributes),{nodes:n,attributes:a}},twoWayBind:function(t){const e=t.path?t.path[0]:t.target;if(!e.dataset.sifrrBind)return;const r=void 0===e.value?"blur"==t.type?e.innerHTML.trim().replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(input|link|img|br|hr|col|keygen)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"):e.innerHTML:e.value;let n={};n[e.dataset.sifrrBind]=r,e.getRootNode().host.state=n},updateState:function(t){if(!t.stateMap)return!1;const e=t.stateMap.nodes,n=e.length;for(let a=0;a<n;a++)r.updateNode(e[a],t);const a=t.stateMap.attributes,s=a.length;for(let e=0;e<s;e++)r.updateAttribute(a[e],t)},updateNode:function(t,e){const n=t.dom.innerHTML;let a=r.evaluateString(t.data,e);n!=a&&(a||(a=""),Array.isArray(a)&&a[0]&&a[0].nodeType?(t.dom.innerHTML="",t.dom.append(...a)):a.nodeType?(t.dom.innerHTML="",t.dom.appendChild(a)):"true"==t.dom.contentEditable||"TEXTAREA"==t.dom.nodeName||"STYLE"==t.dom.nodeName||t.dom.dataset&&"true"==t.dom.dataset.sifrrHtml?n!=a&&(t.dom.innerHTML=a):n!=a&&(t.dom.childNodes[0].textContent=a))},updateAttribute:function(t,e){t.dom.setAttribute(t.name,r.evaluateString(t.value,e))},evaluateString:function(t,e){return t.indexOf("${")<0?t:(t=t.trim()).replace(/\${([^{}$]|{([^{}$])*})*}/g,function(t){let r=t.slice(2,-1);return function(){let n;n=r.search("return")>=0?new Function(r).bind(e):new Function("return "+r).bind(e);try{return n()}catch(e){return t}}()})}};var n=r;var a=class{static parse(t){let e={};if("string"==typeof t){try{e=JSON.parse(t)}catch(e){return t}return this.parse(e)}if(Array.isArray(t))e=[],t.forEach((t,r)=>{e[r]=this.parse(t)});else{if("object"!=typeof t)return t;for(const r in t)e[r]=this.parse(t[r])}return e}static stringify(t){return"string"==typeof t?t:JSON.stringify(t)}};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s,o=(function(t,e){var r;t.exports=(r=class{constructor(t,e,r){this.type=t,this._options=r,this._url=e}get response(){return window.fetch(this.url,this.options).then(t=>{let e,r=t.headers.get("content-type");if(e=r&&r.includes("application/json")?t.json():t.text(),t.ok)return e;{let r=Error(t.statusText);throw r.response=e,r}})}get url(){let t=delete this._options.params;return t&&Object.keys(t).length>0?this._url+"?"+Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&"):this._url}get options(){return Object.assign(this._options,{method:this.type,headers:Object.assign({accept:"application/json"},this._options.headers||{}),mode:"cors",redirect:"follow"})}},class{static get(t,e={}){return new r("GET",t,e).response}static post(t,e={}){return new r("POST",t,e).response}static put(t,e={}){return new r("PUT",t,e).response}static delete(t,e={}){return new r("DELETE",t,e).response}static file(t,e={}){return e.headers=e.headers||{},e.headers.accept=e.headers.accept||"*/*",new r("GET",t,e).response}})}(s={exports:{}},s.exports),s.exports);class i{constructor(t){if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,this.constructor.add(t,this)}get template(){return this.html.then(t=>t.querySelector("template"))}get html(){return this._html=this._html||o.file(this.templateUrl).then(t=>(new window.DOMParser).parseFromString(t,"text/html")),this._html}get templateUrl(){return`/elements/${this.elementName.split("-").join("/")}.html`}executeScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(t=>{new Function(t.text).bind(window)()})})}static add(t,e){i._all[t]=e}static get all(){return i._all}}i._all={};var d=i;var l=class extends window.HTMLElement{static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs||[])}static get template(){return this._template=this._template||new d(this.elementName).template,this._template}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}constructor(){super();let t=this;this.constructor.template.then(e=>{t.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0)),t.stateMap=n.createStateMap(t.shadowRoot),t.shadowRoot.addEventListener("change",n.twoWayBind),n.updateState(this)}),this._state=this.constructor.defaultState||{},this.tag=this.constructor.elementName}connectedCallback(){this.state=a.parse(this.dataset.sifrrState)||{}}disconnectedCallback(){this.shadowRoot?this.shadowRoot.removeEventListener("change",n.twoWayBind):this.removeEventListener("change",n.twoWayBind)}attributeChangedCallback(t,e,r){"data-sifrr-state"===t&&(this.state=a.parse(r))}get state(){return this._state}set state(t){this._lastState=Object.assign({},this.state),Object.assign(this._state,t),n.updateState(this)}isSifrr(t=null){return!t||t==this.constructor.elementName}clearState(){this._lastState=this.state,this._state={},n.updateState(this)}};let c={elements:{}};return c.Element=l,c.Parser=n,c.Vdom=e,c.Loader=d,c.register=function(t){const e=t.elementName;if(e)if(window.customElements.get(e))window.console.warn(`Error creating Element: ${e} - Custom Element with this name is already defined.`);else if(e.indexOf("-")<1)window.console.warn(`Error creating Element: ${e} - Custom Element name must have one dash '-'`);else try{return window.customElements.define(e,t),c.elements[e]=t,!0}catch(t){return window.console.warn(`Error creating Custom Element: ${e} - ${t}`),!1}else window.console.warn("Error creating Custom Element: No name given.",t);return!1},c.setup=function(){c.register(class extends HTMLElement{static get elementName(){return"sifrr-node"}connectedCallback(){this.style.whiteSpace="pre"}}),window.document.addEventListener("input",c.Parser.twoWayBind,{capture:!0,passive:!0}),window.document.addEventListener("blur",c.Parser.twoWayBind,{capture:!0,passive:!0})},c.load=function(t){new c.Loader(t).executeScripts()},c});
/*! (c) @aadityataparia */
