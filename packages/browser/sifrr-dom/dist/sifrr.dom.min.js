/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e={absolute:(t,e)=>{let n=t.split("/"),r=e.split("/");n.pop();for(let t=0;t<r.length;t++)"."!=r[t]&&(".."==r[t]?n.pop():n.push(r[t]));return n.join("/")},getRoutes:t=>{"/"!=t[0]&&(t="/"+t);let e=t.indexOf("?");return-1!=e&&(t=t.substring(0,e)),t.split("/")}};const n={parse:t=>{let e={};if("string"==typeof t){try{e=JSON.parse(t)}catch(e){return t}return n.parse(e)}if(Array.isArray(t))e=[],t.forEach((t,r)=>{e[r]=n.parse(t)});else{if("object"!=typeof t)return t;for(const r in t)e[r]=n.parse(t[r])}return e},stringify:t=>"string"==typeof t?t:JSON.stringify(t),shallowEqual:(t,e)=>{for(let n in t)if(!(n in e)||t[n]!=e[n])return!1;for(let n in e)if(!(n in t)||t[n]!=e[n])return!1;return!0},deepClone:t=>{if(Array.isArray(t))return t.map(t=>n.deepClone(t));if("object"!=typeof t||null===t)return t;let e={};for(let r in t)e[r]=n.deepClone(t[r]);return e}};var r=n;var s={updateAttribute:function(t,e,n){const r=t.getAttribute(e);r!=n&&("null"!=n&&"undefined"!=n&&"false"!=n&&n?t.setAttribute(e,n):r&&t.removeAttribute(e)),"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=n)}};const o=window.document.createElement("template"),a=window.document.createElement("sifrr-node");var i={SIFRR_NODE:()=>a.cloneNode(),TEMPLATE:()=>o.cloneNode(),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1};const{updateAttribute:l}=s,{shallowEqual:c}=r,{TEXT_NODE:u,COMMENT_NODE:d}=i;function h(t,e){const n=t.childNodes.length,r=e.length;if(n>r){let e=n;for(;e>r;)t.removeChild(t.lastChild),e--}else if(n<r){let s=n;for(;s<r;)t.appendChild(e[s]),s++}const s=Math.min(r,n);for(let n,r=0,o=t.firstChild;r<s;r++)o=f(o,n=e[r]).nextSibling}function f(t,e){if(null===e)return t;if("stateChange"===e.type)return c(t.state,e.state)||(t.state=e.state),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===u||t.nodeType===d)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);let n,r=t.attributes,s=e.attributes;for(let e=s.length-1;e>=0;--e)l(t,s[e].name,s[e].value);for(let s=r.length-1;s>=0;--s)n=r[s],e.hasAttribute(n.name)||!1===n.specified||t.removeAttribute(n.name);return h(t,e.childNodes),t}var m={makeEqual:f,makeChildrenEqual:h};const p=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);p.roll=function(t,e=!1){let n=this.currentNode;for(;--t;)n=e&&e(n)?p.nextSibling()||p.parentNode():p.nextNode();return n};class g{constructor(t,e){this.idx=t,this.ref=e}}var w={walker:p,collect:function(t,e=t.stateMap,n){const r=[];return p.currentNode=t,e.map(t=>r.push(p.roll(t.idx,n))),r},create:function(t,e,n=!1){let r,s=[],o=0;for(p.currentNode=t;t;)(r=e(t))?(s.push(new g(o+1,r)),o=1):o++,t=n&&n(t)?p.nextSibling()||p.parentNode():p.nextNode();return s},Ref:g};const{makeChildrenEqual:y}=m,{updateAttribute:b}=s,{collect:E,create:N}=w,{TEXT_NODE:_,COMMENT_NODE:S,ELEMENT_NODE:v}=i,T=i.TEMPLATE();function C(t){return t.dataset&&"true"==t.dataset.sifrrHtml||"true"==t.contentEditable||"TEXTAREA"==t.nodeName||"STYLE"==t.nodeName||t.dataset&&t.dataset.sifrrRepeat}function O(t){if(t.nodeType===_||t.nodeType===S){const e=t.nodeValue;if(e.indexOf("${")>-1)return{html:!1,text:e.trim()}}else if(t.nodeType===v){const e={};if(C(t)){const n=t.innerHTML;n.indexOf("${")>=0&&(e.html=!0,e.text=n.replace(/<!--(.*)-->/g,"$1"))}const n=t.attributes||[],r=n.length,s={events:{}};for(let t=0;t<r;t++){const e=n[t];if("$"===e.name[0])s.events[e.name]=e.value;else if(e.value.indexOf("${")>=0)if("style"===e.name){const t={};e.value.split(";").forEach(e=>{const[n,r]=e.split(/:(?!\/\/)/);n&&r&&r.indexOf("${")>=0&&(t[n.trim()]=r.trim())}),s[e.name]=t}else s[e.name]=e.value}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(e.attributes=s),Object.keys(e).length>0)return e}return 0}const $={collectRefs:(t,e)=>E(t,e,C),createStateMap:t=>N(t,O,C),update:t=>{if(!t._refs)return!1;const e=t._refs.length;for(let n=0;n<e;n++){const e=t.constructor.stateMap[n].ref,r=t._refs[n];if(e.attributes)for(let n in e.attributes)if("events"===n)for(let n in e.attributes.events){const s=$.evaluateString(e.attributes.events[n],t,!0);"${this"===e.attributes.events[n].slice(0,6)?r[n]=s.bind(t):r[n]=s}else if("style"===n)for(let n in e.attributes.style)r.style[n]=$.evaluateString(e.attributes.style[n],t);else{const s=$.evaluateString(e.attributes[n],t);b(r,n,s)}if(void 0===e.html)continue;const s=$.evaluateString(e.text,t);if(s)if(e.html){let t;Array.isArray(s)?t=s:s.nodeType?t=[s]:(T.innerHTML=s.toString().replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"),t=Array.prototype.slice.call(T.content.childNodes)),t.length<1?r.textContent="":y(r,t)}else r.nodeValue!=s&&(r.nodeValue=s);else r.textContent=""}},twoWayBind:t=>{const e=t.path?t.path[0]:t.target;if(!e.dataset.sifrrBind)return;const n=void 0===e.value?e.innerHTML:e.value;let r,s={};if(e._root)r=e._root;else{for(r=e;!r.isSifrr;)r=r.parentNode||r.host;e._root=r}s[e.dataset.sifrrBind]=n,r.state=s},evaluateString:(t,e)=>{return t.indexOf("${")<0?t:(t=t.trim()).match(/^\${([^{}$]|{([^{}$])*})*}$/)?n(t):n("`"+t+"`");function n(t){let n;return"$"==t[0]&&(t=t.slice(2,-1)),(n=t.indexOf("return ")>=0?new Function(t).bind(e):new Function("return "+t).bind(e))()}}};var A=$;const{TEMPLATE:x}=i;var M=(t,...e)=>{const n=x();if("string"==typeof t)n.innerHTML=t.replace(/{{(.*)}}/g,"${$1}");else if(t[0]&&"string"==typeof t[0])t=String.raw(t,...e).replace(/{{(.*)}}/g,"${$1}"),n.innerHTML=t;else{if(!t[0])return t;Array.from(t).forEach(t=>{n.appendChild(t)})}return n};class j{constructor(e,n){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e].instance;this.elementName=e,this.url=n,this.constructor.urls[e]=this.htmlUrl}get html(){const e=this;if(this.constructor.all[this.elementName]&&this.constructor.all[this.elementName].html)return this.constructor.all[this.elementName].html;const n=t.file(this.htmlUrl).then(t=>t.text()).then(t=>M(t).content).then(t=>(j._all[e.elementName].template=t.querySelector("template"),t));return j.add(e.elementName,{instance:e,html:n}),n}get js(){if(this.constructor.all[this.elementName]&&this.constructor.all[this.elementName].js)return this.constructor.all[this.elementName].js;const e=t.file(this.jsUrl).then(t=>t.text());return j.add(this.elementName,{instance:this,js:e}),e}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"||""}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"||""}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){return t?this.js.then(t=>{new Function(t).bind(window)()}):this.html.then(t=>{t.querySelectorAll("script").forEach(t=>{t.hasAttribute("src")?window.document.body.appendChild(t):new Function(t.text).bind(window)()})}).catch(t=>{"Not Found"===t.message?(window.console.log(`HTML file not found. Trying to get js file for ${this.elementName}.`),this.js.then(t=>{new Function(t).bind(window)()})):window.console.warn(t)})}static add(t,e){j._all[t]=Object.assign(j._all[t]||{},e)}static get all(){return j._all}}j._all={},j.urls={};var L=j;const{collect:D,create:R}=w;function k(t){if(3!==t.nodeType){if(void 0!==t.attributes){const e=Array.from(t.attributes),n=e.length,r=[];for(let t=0;t<n;t++){const n=e[t].value;"$"===n[0]&&r.push({name:e[t].name,text:n.slice(2,-1)})}if(r.length>0)return r}return 0}{let e=t.nodeValue;return"$"===e[0]?(t.nodeValue="",e.slice(2,-1)):0}}function q(t){const e=t._refs,n=t.stateMap,r=n.length,s=t.state,o=t._oldState;for(let t=0;t<r;t++){const r=n[t].ref,a=e[t];if(Array.isArray(r)){const t=r.length;for(let e=0;e<t;e++){const t=r[e];o[t.text]!==s[t.text]&&("class"===t.name?a.className=s[t.text]||"":a.setAttribute(t.name,s[t.text]))}}else o[r]!=s[r]&&(a.nodeValue=s[r])}}var P=function(t,e){if("string"==typeof t){const e=M(t),n=(t=e.content.firstElementChild||e.content.firstChild).style.display;t.style.display="none",window.document.body.appendChild(t),t.remove(),t.style.display=n}return-1!==t.nodeName.indexOf("-")||t.getAttribute("is")&&t.getAttribute("is").indexOf("-")>=0||t.isSifrr&&t.isSifrr()?t:(t.stateMap=R(t,k),t._refs=D(t,t.stateMap),Object.defineProperty(t,"state",{get:()=>t._state,set:e=>{t._oldState=Object.assign({},t._state),t._state=Object.assign(t._state||{},e),q(t)}}),e&&(t.state=e),t.sifrrClone=function(e){const n=t.cloneNode(e);return n.stateMap=t.stateMap,n._refs=D(n,t.stateMap),Object.defineProperty(n,"state",{get:()=>n._state,set:t=>{n._oldState=Object.assign({},n._state),n._state=Object.assign(n._state||{},t),q(n)}}),t.state&&(n.state=t.state),n},t)};var U=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){const t=(L.all[this.elementName]||{template:!1}).template;return window.ShadyCSS&&this.useShadowRoot&&window.ShadyCSS.prepareTemplate(t,this.elementName),t}static get ctemp(){return this._ctemp=this._ctemp||this.template,this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||A.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static onStateChange(){}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){(this.constructor.defaultState||this.state)&&(this._state=Object.assign({},this.constructor.defaultState,this.state));const t=this.constructor.ctemp.content.cloneNode(!0);this.constructor.useShadowRoot?(this._refs=A.collectRefs(t,this.constructor.stateMap),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t),this.shadowRoot.addEventListener("change",A.twoWayBind)):this.__content=t}}connectedCallback(){this.constructor.useShadowRoot?!this.hasAttribute("data-sifrr-state")&&this._state&&this.update():(this.textContent="",this._refs=A.collectRefs(this.__content,this.constructor.stateMap),this.appendChild(this.__content),(this._state||this.hasAttribute("data-sifrr-state"))&&this.update()),this.onConnect()}onConnect(){}disconnectedCallback(){this.shadowRoot&&this.shadowRoot.removeEventListener("change",A.twoWayBind),this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){"data-sifrr-state"===t&&(this.state=r.parse(n)),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){this._state=this._state||{},this._state!==t&&Object.assign(this._state,t),this.update()}update(){A.update(this),this.onStateChange(),this.constructor.onStateChange(this)}onStateChange(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t){return this.cloneNode(t)}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}static addArrayToDom(t,e){this._arrayToDom=this._arrayToDom||{},this._arrayToDom[this.elementName]=this._arrayToDom[this.elementName]||{},this._arrayToDom[this.elementName][t]=P(e)}arrayToDom(t,e=this.state[t]){this._domL=this._domL||{};const n=this._domL[t]||0,r=[],s=e.length;let o;try{o=this.constructor._arrayToDom[this.constructor.elementName][t]}catch(e){return window.console.error(`[error]: No arrayToDom data of '${t}' added in ${this.constructor.elementName}.`)}for(let t=0;t<s;t++)if(t<n)r.push({type:"stateChange",state:e[t]});else{const n=o.sifrrClone(!0);n.state=e[t],r.push(n)}return this._domL[t]=s,r}}}(window.HTMLElement);const F={},H=(t,e,n,r)=>{function s(e){e.forEach(e=>e(t,r,n))}for(let t in F[e])("function"==typeof n.matches&&n.matches(t)||9===n.nodeType&&"document"===t)&&s(F[e][t])};var W={add:t=>!F[t]&&(window.addEventListener(t,e=>((t,e)=>Promise.resolve((()=>{const n=t.composedPath?t.composedPath()[0]:t.target;let r=n;for(;r;){const s=r[`$${e}`];s&&s(t,n),H(t,e,r,n),r=r.parentNode||r.host}})()))(e,t),{capture:!0,passive:!0}),F[t]={},!0),addListener:(t,e,n)=>{const r=F[t][e]||[];return r.indexOf(n)<0&&r.push(n),F[t][e]=r,!0},removeListener:(t,e,n)=>{const r=F[t][e]||[],s=r.indexOf(n);return s>=0&&r.splice(s,1),F[t][e]=r,!0},trigger:(t,e,n)=>{t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},n)))}};let B={elements:{},loadingElements:[]};return B.Element=U,B.Parser=A,B.Loader=L,B.SimpleElement=P,B.Event=W,B.makeEqual=m,B.Url=e,B.Json=r,B.template=M,B.register=((t,e)=>{t.useSR=B.config.useShadowRoot;const n=t.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(n))window.console.warn(`Error creating Element: ${n} - Custom Element with this name is already defined.`);else{if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,t,e),B.elements[n]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${n} - ${t}`,t.trace),!1}}return!1}),B.setup=function(t){B.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),B.Event.add("input"),B.Event.add("change"),B.Event.addListener("change","document",B.Parser.twoWayBind),B.Event.addListener("input","document",B.Parser.twoWayBind)},B.load=function(t,{url:e,js:n=!1}={}){let r=new B.Loader(t,e);return B.loadingElements.push(customElements.whenDefined(t)),r.executeScripts(n)},B.loading=(()=>Promise.all(B.loadingElements)),B.relativeTo=function(t,e){if("string"==typeof t)return B.Url.absolute(B.Loader.urls[t],e)},B});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
