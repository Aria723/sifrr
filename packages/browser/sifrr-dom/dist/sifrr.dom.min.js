/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const e=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);e.nextNonfilterNode=function(t){let e=this.currentNode;return e=t&&t(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},e.roll=function(t,e){let r=this.currentNode;for(;--t;)r=this.nextNonfilterNode(e);return r};class r{constructor(t,e){this.idx=t,this.ref=e}}var n={collect:function(t,r,n=!1){const s=[];return e.currentNode=t,r.map(t=>s.push(e.roll(t.idx,n))),s},create:function(t,n,s=!1){let o,i=[],a=0;for(e.currentNode=t;t;)(o=n(t,s))?(i.push(new r(a+1,o)),a=1):a++,t=e.nextNonfilterNode(s);return i},Ref:r};const s=window.document.createElement("template"),o=window.document.createElement("script");var i={TEMPLATE:()=>s.cloneNode(!1),SCRIPT:()=>o.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g")};const{OUTER_REGEX:a}=i;function l(t){let e;return e=t.indexOf("return ")>=0?t:"return "+t,new Function(e)}function c(t,e){try{return"string"==typeof t?t:t.call(e)||""}catch(r){window.console.error(r);const n=t.toString();window.console.log(`Error evaluating: \`${n.slice(n.indexOf("{")+1,n.lastIndexOf("}"))}\` for element`,e)}}var d={getBindingFxns:t=>{const e=t.split(a),r=e.length,n=[];for(let t=0;t<r;t++)"$"===e[t][0]&&"{"===e[t][1]?n.push(l(e[t].slice(2,-1))):e[t]&&n.push(e[t]);return n},evaluateBindings:(t,e)=>1===t.length?c(t[0],e):t.map(t=>c(t,e)).join(""),evaluate:c,replacer:l};const{TEXT_NODE:h,COMMENT_NODE:u,ELEMENT_NODE:m}=i,{getBindingFxns:f}=d;var p={creator:function(t,e){if(t.nodeType===h||t.nodeType===u){const e=t.data;if(e.indexOf("${")>-1)return{html:!1,text:f(e.trim())}}else if(t.nodeType===m){const r={};if(e(t)){const e=t.innerHTML;e.indexOf("${")>=0&&(r.html=!0,r.text=f(e.replace(/<!--(.*)-->/g,"$1").trim()))}const n=t.attributes,s=n.length,o={events:{}};for(let t=0;t<s;t++){const e=n[t];"_"===e.name[0]?o.events[e.name]=f(e.value):e.value.indexOf("${")>=0&&(o[e.name]=f(e.value))}if(0===Object.keys(o.events).length&&delete o.events,Object.keys(o).length>0&&(r.attributes=o),Object.keys(r).length>0)return r}return 0},simpleCreator:function(t){if(t.nodeType===m){const e=Array.prototype.slice.call(t.attributes),r=e.length,n=[];for(let s=0;s<r;s++){const r=e[s].value;"$"===r[0]&&(n.push({name:e[s].name,text:r.slice(2,-1)}),t.setAttribute(e[s].name,""))}return n.length>0?n:0}{let e=t.data;return"$"===e[0]?(t.data="",e.slice(2,-1)):0}}};const{collect:g,create:w}=n,{creator:E}=p;function y(t){return t.dataset&&"true"==t.dataset.sifrrHtml||t.dataset&&t.dataset.sifrrRepeat}var _={collectRefs:(t,e)=>g(t,e,y),createStateMap:t=>w(t,E,y),twoWayBind:t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.dataset.sifrrBind||null===e._root)return;const r=e.value||e.textContent;let n={};if(!e._root){let t;for(t=e;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}n[e.dataset.sifrrBind]=r,e._root&&(e._root.state=n)}},N=(t,e,r)=>{t.getAttribute(e)!=r&&("class"===e?t.className=r:t.setAttribute(e,r)),"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=r)};var S={shallowEqual:(t,e)=>{for(let r in t)if(!(r in e)||t[r]!==e[r])return!1;for(let r in e)if(!(r in t)||t[r]!==e[r])return!1;return!0}};const{shallowEqual:b}=S,{TEXT_NODE:v,COMMENT_NODE:T}=i;function x(t,e){const r=t.childNodes.length,n=e.length;if(r>n){let e=r;for(;e>n;)t.removeChild(t.lastChild),e--}else if(r<n){let s=r;for(;s<n;)t.appendChild(e[s]),s++}const s=Math.min(n,r);for(let r,n=0,o=t.firstChild;n<s;n++)o=C(o,r=e[n]).nextSibling}function C(t,e){if("stateChange"===e.type)return b(t.state,e.state)||(t.state=e.state),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===v||t.nodeType===T)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);let r,n=t.attributes,s=e.attributes;for(let e=s.length-1;e>=0;--e)N(t,s[e].name,s[e].value);for(let s=n.length-1;s>=0;--s)r=n[s],e.hasAttribute(r.name)||t.removeAttribute(r.name);return x(t,Array.prototype.slice.call(e.childNodes)),t}var M={makeEqual:C,makeChildrenEqual:x};const{makeChildrenEqual:O}=M,{evaluateBindings:A}=d,$=i.TEMPLATE();var L={update:function(t){if(!t._refs)return!1;const e=t._refs.length;for(let r=0;r<e;r++){const e=t.constructor.stateMap[r].ref,n=t._refs[r];if(e.attributes)for(let r in e.attributes)if("events"===r){for(let r in e.attributes.events){const s=A(e.attributes.events[r],t);n[r]=s}n._root=t,delete e.attributes.events}else{const s=A(e.attributes[r],t);N(n,r,s)}if(void 0===e.html)continue;const s=A(e.text,t);if(s)if(e.html){let t;if(Array.isArray(s)?t=s:s.content&&11===s.content.nodeType?t=Array.prototype.slice.call(s.content.childNodes):s.nodeType?t=[s]:"string"==typeof s?($.innerHTML=s.toString(),t=Array.prototype.slice.call($.content.childNodes)):t=Array.prototype.slice.call(s),0===t.length){n.textContent="";continue}O(n,t)}else n.data!=s&&(n.data=s);else n.textContent=""}t.onUpdate()},simpleUpdate:function(t){const e=t._refs,r=t.stateMap,n=r.length;for(let s=0;s<n;s++){const n=r[s].ref,o=e[s];if(Array.isArray(n)){const e=n.length;for(let r=0;r<e;r++){const e=n[r];"class"===e.name?o.className=t.state[e.text]:o.setAttribute(e.name,t.state[e.text])}}else o.data=t.state[n]}}};const{TEMPLATE:R}=i;var j=(t,...e)=>{const r=R();if("string"==typeof t);else{if(!t[0]||"string"!=typeof t[0])return t[0]?(Array.from(t).forEach(t=>{r.content.appendChild(t)}),r):t;t=String.raw(t,...e)}return t=t.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),r.innerHTML=t,r};class D{constructor(e,r){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=r}get html(){if(this._html)return this._html;D.add(this.elementName,this);const e=this;return this._html=t.file(this.htmlUrl).then(t=>t.text()).then(t=>j(t).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(D.add(this.elementName,this),this._js=t.file(this.jsUrl).then(t=>t.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,t?this.js.then(t=>{new Function(t).bind(window)()}).catch(t=>(window.console.error(t),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(t=>{if(t.src){const e=i.SCRIPT();e.src=t.src,e.type=t.type,window.document.body.appendChild(e)}else new Function(t.text).call(window)})}).catch(t=>{throw t})}static add(t,e){D._all[t]=e}static get all(){return D._all}}D._all={};var P=D;const{collect:q,create:U}=n,{simpleUpdate:H}=L,{simpleCreator:k}=p;var B=function(t,e=null){let r;if("string"==typeof t)r=j(t),t=r.content.firstElementChild||r.content.firstChild;else if(!t.nodeType)throw TypeError("First argument for SimpleElement should be of type string or DOM element");return t.isSifrr?t:-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&-1!==t.getAttribute("is").indexOf("-")?(window.document.body.appendChild(t),t.remove(),t):(t.stateMap=U(t,k),t._refs=q(t,t.stateMap),Object.defineProperty(t,"state",{get:()=>t._state,set:e=>{t._state=Object.assign(t._state||{},e),H(t)}}),e&&(t.state=e),t.sifrrClone=function(e=!0){const r=t.cloneNode(e);return r.stateMap=t.stateMap,r._refs=q(r,t.stateMap),Object.defineProperty(r,"state",{get:()=>r._state,set:t=>{r._state=Object.assign(r._state||{},t),H(r)}}),t.state&&(r.state=t.state),r},t)};const F={},W={capture:!0,passive:!0},X=(t,e)=>Promise.resolve((()=>{const r=t.composedPath?t.composedPath()[0]:t.target;let n=r;for(;n;){const s=n[`_${e}`]||(n.getAttribute?n.getAttribute(`_${e}`):null);"function"==typeof s?s.call(n._root||window,t,r):"string"==typeof s&&new Function("event","target",s).call(n._root||window,event,r),I(t,e,n,r),n=n.parentNode||n.host}})()),I=(t,e,r,n)=>{function s(e){e.forEach(e=>e(t,n,r))}for(let t in F[e])("function"==typeof r.matches&&r.matches(t)||9===r.nodeType&&"document"===t)&&s(F[e][t])};var G={all:F,add:t=>!F[t]&&(window.addEventListener(t,e=>X(e,t),W),F[t]={},!0),addListener:(t,e,r)=>{const n=F[t][e]||[];return n.indexOf(r)<0&&n.push(r),F[t][e]=n,!0},removeListener:(t,e,r)=>{const n=F[t][e]||[],s=n.indexOf(r);return s>=0&&n.splice(s,1),F[t][e]=n,!0},trigger:(t,e,r)=>{"string"==typeof t&&(t=document.querySelector(t)),t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},r)))},opts:W};const{update:J}=L,{opts:z}=G;var Z=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(P.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||_.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.ctemp.content.cloneNode(!0);this.constructor.useShadowRoot?(this._refs=_.collectRefs(t,this.constructor.stateMap),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t),this.shadowRoot.addEventListener("change",_.twoWayBind,z)):this.__content=t}}connectedCallback(){this.constructor.useShadowRoot||(this.textContent="",this._refs=_.collectRefs(this.__content,this.constructor.stateMap),this.appendChild(this.__content)),this.hasAttribute("data-sifrr-state")&&this.constructor.useShadowRoot||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.shadowRoot&&this.shadowRoot.removeEventListener("change",_.twoWayBind,z),this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,r){"data-sifrr-state"===t&&(this.state=JSON.parse(r)),this.onAttributeChange(t,e,r)}onAttributeChange(){}get state(){return this._state}set state(t){this._state!==t&&Object.assign(this._state,t),this.update(),this.onStateChange()}onStateChange(){}update(){J(this)}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t){return this.cloneNode(t)}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}static addArrayToDom(t,e){this._arrayToDom=this._arrayToDom||{},this._arrayToDom[this.elementName]=this._arrayToDom[this.elementName]||{},this._arrayToDom[this.elementName][t]=B(e)}arrayToDom(t,e=this.state[t]){this._domL=this._domL||{};const r=this._domL[t]||0,n=[],s=e.length;let o;try{if(!(o=this.constructor._arrayToDom[this.constructor.elementName][t]))throw Error("")}catch(e){return window.console.error(`[error]: No arrayToDom data of '${t}' added in ${this.constructor.elementName}.`)}for(let t=0;t<s;t++)if(t<r)n.push({type:"stateChange",state:e[t]});else{const r=o.sifrrClone(!0);r.state=e[t],n.push(r)}return this._domL[t]=s,n}}}(window.HTMLElement);let K={elements:{},loadingElements:[]};return K.Element=Z,K.Parser=_,K.Loader=P,K.SimpleElement=B,K.Event=G,K.makeEqual=M,K.template=j,K.register=((t,e)=>{t.useSR=K.config.useShadowRoot;const r=t.elementName;if(!r)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(r))throw Error(`Error creating Element: ${r} - Custom Element with this name is already defined.`);if(r.indexOf("-")<1)throw Error(`Error creating Element: ${r} - Custom Element name must have one dash '-'`);try{return window.customElements.define(r,t,e),K.elements[r]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${r} - ${t.message}`,t.trace),!1}}),K.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,K.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),"string"!=typeof K.config.baseUrl)throw Error("baseUrl should be a string");K.Event.add("input"),K.Event.add("change"),K.Event.addListener("change","document",K.Parser.twoWayBind),K.Event.addListener("input","document",K.Parser.twoWayBind)},K.load=function(t,{url:e,js:r=!0}={}){if(window.customElements.get(t))return window.console.warn(`Error loading Element: ${t} - Custom Element with this name is already defined.`);let n=new K.Loader(t,e);return K.loadingElements.push(customElements.whenDefined(t)),n.executeScripts(r)},K.loading=(()=>Promise.all(K.loadingElements)),K});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
