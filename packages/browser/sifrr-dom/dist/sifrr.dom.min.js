/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],t):((e=e||self).Sifrr=e.Sifrr||{},e.Sifrr.Dom=t(e.Sifrr.Fetch))}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const t=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);t.nextNonfilterNode=function(e){let t=this.currentNode;return t=e&&e(t)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},t.roll=function(e,t){let n=this.currentNode;for(;--e;)n=this.nextNonfilterNode(t);return n};class n{constructor(e,t){this.idx=e,this.ref=t}}var r={collect:function(e,n,r=!1){const o=[],i=n.length;t.currentNode=e;for(let e=0;e<i;e++)o.push(t.roll(n[e].idx,r));return o},create:function(e,r,o=!1){let i,s=[],a=0;for(t.currentNode=e;e;)(i=r(e,o))?(s.push(new n(a+1,i)),a=1):a++,e=t.nextNonfilterNode(o);return s},Ref:n};const o=window.document.createElement("template"),i=window.document.createElement("script");var s={TEMPLATE:()=>o.cloneNode(!1),SCRIPT:()=>i.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const{TEMPLATE:a}=s;var l=(e,...t)=>{const n=a();if("string"==typeof e);else{if(!e[0]||"string"!=typeof e[0])return e[0]?(Array.from(e).forEach(e=>{n.content.appendChild(e)}),n):e.nodeType&&!e.content?(n.content.appendChild(e),n):e;e=String.raw(e,...t)}return e=e.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=e,n},c=(e,t,n)=>{const r=e.getAttribute(t);!1===n||null==n?e.removeAttribute(t):r!==n&&("class"===t?e.className=n:e.setAttribute(t,n)),"value"!=t||"SELECT"!=e.nodeName&&"INPUT"!=e.nodeName||(e.value=n)};var u=function(e){const t=e._refs,n=e.stateMap,r=n.length;for(let o=0;o<r;o++){const r=n[o].ref,i=t[o];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;n++)c(i,r[n].name,e.state[r[n].text])}else i.data!=e.state[r]&&(i.data=e.state[r]||"")}};const{ELEMENT_NODE:d}=s;var h=function(e){if(e.nodeType===d){const t=Array.prototype.slice.call(e.attributes),n=t.length,r=[];for(let o=0;o<n;o++){const n=t[o].value;"$"===n[0]&&(r.push({name:t[o].name,text:n.slice(2,-1)}),e.setAttribute(t[o].name,""))}return r.length>0?r:0}{let t=e.data;return"$"===t[0]?(e.data="",t.slice(2,-1)):0}};const{collect:f,create:m}=r;var p=function(e,t=null){if(!(e.nodeType||"string"==typeof e||e[0]&&e[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=l(e);if((e=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==e.nodeName.indexOf("-")||e.getAttribute&&e.getAttribute("is")&&-1!==e.getAttribute("is").indexOf("-"))return e;const r=m(e,h);function o(e){e.stateMap=r,e._refs=f(e,r),Object.defineProperty(e,"state",{get:()=>e._state,set:t=>{e._state=Object.assign(e._state||{},t),u(e)}})}return o(e),t&&(e.state=t),e.sifrrClone=function(t=!0,n){const r=e.cloneNode(t);return o(r),n?r.state=n:e.state&&(r.state=e.state),r},e};const{OUTER_REGEX:g}=s;function E(e){let t;t=e.indexOf("return ")>=0?e:"return "+e;try{return new Function(t)}catch(e){return window.console.log(`Error processing binding: \`${t}\``),""}}function w(e,t){try{return"string"==typeof e?e:e.call(t)}catch(n){const r=e.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,t),window.console.error(n)}}var y={getBindingFxns:e=>{const t=e.split(g),n=t.length,r=[];for(let e=0;e<n;e++)"$"===t[e][0]&&"{"===t[e][1]?r.push(E(t[e].slice(2,-1))):t[e]&&r.push(t[e]);return r},evaluateBindings:(e,t)=>1===e.length?w(e[0],t):e.map(e=>w(e,t)).join(""),evaluate:w,replacer:E};const{TEXT_NODE:b,COMMENT_NODE:S,ELEMENT_NODE:v,REPEAT_ATTR:_}=s,{getBindingFxns:T}=y;var N={creator:function(e,t){if(e.nodeType===b||e.nodeType===S){const t=e.data;if(t.indexOf("${")>-1)return{type:0,text:T(t.trim())}}else if(e.nodeType===v){const n={};if(t(e)){const t=e.innerHTML;t.indexOf("${")>=0&&(n.type=1,n.text=T(t.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else e.hasAttribute(_)&&(n.type=2,n.se=p(e.childNodes),n.text=T(e.getAttribute(_)),e.removeAttribute(_),e.textContent="");const r=e.attributes,o=r.length,i={events:{}};for(let e=0;e<o;e++){const t=r[e];"_"===t.name[0]?i.events[t.name]=T(t.value):t.value.indexOf("${")>=0&&(i[t.name]=T(t.value))}if(0===Object.keys(i.events).length&&delete i.events,Object.keys(i).length>0&&(n.attributes=i),Object.keys(n).length>0)return n}return 0}};const{collect:x,create:C}=r,{creator:A}=N,{ELEMENT_NODE:O,HTML_ATTR:M}=s;function $(e){return e.nodeType===O&&e.hasAttribute(M)}var L={collectRefs:(e,t)=>x(e,t,$),createStateMap:e=>C(e,A,$),twoWayBind:e=>{const t=e.composedPath?e.composedPath()[0]:e.target;if(!t.hasAttribute("data-sifrr-bind")||null===t._root)return;const n=t.value||t.textContent;let r={};if(!t._root){let e;for(e=t;e&&!e.isSifrr;)e=e.parentNode||e.host;t._root=e||null}r[t.getAttribute("data-sifrr-bind")]=n,t._root&&(t._root.state=r)}};var R={shallowEqual:(e,t)=>{for(let n in e)if(!(n in t)||e[n]!==t[n])return!1;for(let n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}};const{shallowEqual:j}=R,{TEXT_NODE:q,COMMENT_NODE:k}=s;function P(e,t,n){const r=e.childNodes.length,o=t.length;if(0===o)return void(e.textContent="");if(0===r){let r;for(let i=0;i<o;i++)r=t[i],t[i].nodeType||(r=n(t[i])),e.appendChild(r);return}if(r>o){let t=r;for(;t>o;)e.removeChild(e.lastChild),t--}else if(r<o){let i,s=r;for(;s<o;)i=t[s],t[s].nodeType||(i=n(t[s])),e.appendChild(i),s++}const i=Math.min(o,r);for(let n,r=0,o=e.firstChild;r<i;r++)o=D(o,n=t[r]).nextSibling}function D(e,t){if(!t.nodeType)return j(e.state,t)||(e.state=t),e;if(e.nodeName!==t.nodeName)return e.replaceWith(t),t;if(e.nodeType===q||e.nodeType===k)return e.data!==t.data&&(e.data=t.data),e;t.state&&(e.state=t.state);let n,r=e.attributes,o=t.attributes;for(let t=o.length-1;t>=0;--t)c(e,o[t].name,o[t].value);for(let o=r.length-1;o>=0;--o)n=r[o],t.hasAttribute(n.name)||e.removeAttribute(n.name);return P(e,Array.prototype.slice.call(t.childNodes)),e}var U={makeEqual:D,makeChildrenEqual:P};const{makeEqual:H}=U;function B(e,t){let n=[],r=[],o=-1,i=new Array(e.length);for(let s=t,a=e.length;s<a;s++){let t=e[s];if(t<0)continue;let a=F(n,t);-1!==a&&(i[s]=r[a]),a===o?(n[++o]=t,r[o]=s):t<n[a+1]&&(n[a+1]=t,r[a+1]=s)}for(let e=r[o];o>=0;e=i[e],o--)n[o]=e;return n}function F(e,t){let n=-1,r=e.length;if(r>0&&e[r-1]<=t)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);e[o]>t?r=o:n=o}return n}var W={makeChildrenEqualKeyed:function(e,t,n=(e=>e),r){const o=t.length;if(0===o)return void(e.textContent="");const i=e.childNodes.length;if(0===i){for(let r=0;r<o;r++)e.appendChild(n(t[r]));return}const s=[];let a=e.firstChild;for(;a;)s.push(a.state),a=a.nextSibling;let l,c,u,d=0,h=0,f=!0,m=i-1,p=o-1,g=e.firstChild,E=e.lastChild;e:for(;f;){for(f=!1,c=s[d],u=t[h];c[r]===u[r];){if(H(g,u),d++,g=g.nextSibling,h++,m<d||p<h)break e;c=s[d],u=t[h]}for(c=s[m],u=t[p];c[r]===u[r];){if(H(E,u),m--,l=E,E=E.previousSibling,p--,m<d||p<h)break e;c=s[m],u=t[p]}for(c=s[m],u=t[h];c[r]===u[r];){if(f=!0,H(E,u),a=E.previousSibling,e.insertBefore(E,g),E=a,h++,--m<d||p<h)break e;c=s[m],u=t[h]}for(c=s[d],u=t[p];c[r]===u[r];){if(f=!0,H(g,u),a=g.nextSibling,e.insertBefore(g,E.nextSibling),l=g,E=g.previousSibling,g=a,p--,m<++d||p<h)break e;c=s[d],u=t[p]}}if(p<h){if(d<=m){let t;for(;d<=m;)0===m?e.removeChild(E):(t=E.previousSibling,e.removeChild(E),E=t),m--}return}if(m<d){if(h<=p)for(;h<=p;)a=n(t[h]),e.insertBefore(a,E.nextSibling),E=a,h++;return}const w=new Array(p+1-h),y=new Map,b=[];for(let e=h;e<=p;e++)w[e]=-1,y.set(t[e][r],e);let S=0;for(let e=d;e<=m;e++)y.has(s[e][r])?(w[y.get(s[e][r])]=e,S++):b.push(e);if(0===S){for(let r=h;r<=p;r++)r>m?e.insertBefore(n(t[r]),g):(a=g.nextSibling,g.replaceWith(n(t[r])),g=a);if(p<m)for(;p<m;)a=E.previousSibling,e.removeChild(E),E=a,m--;return}const v=B(w,h),_=[];for(;d<=m;)_[d]=g,g=g.nextSibling,d++;let T,N=v.length-1;for(let r=p;r>=h;r--)v[N]===r?(l=_[w[r]],H(l,t[r]),N--):(-1===w[r]?T=n(t[r]):(T=_[w[r]],H(T,t[r])),e.insertBefore(T,l),l=T);for(let t=0;t<b.length;t++)e.removeChild(_[b[t]])},longestPositiveIncreasingSubsequence:B};const{makeChildrenEqual:I}=U,{makeChildrenEqualKeyed:X}=W,{evaluateBindings:K}=y,{TEMPLATE:G,KEY_ATTR:J}=s;var Y=function(e){if(!e._refs)return!1;const t=e._refs.length;for(let n=0;n<t;n++){const t=e.constructor.stateMap[n].ref,r=e._refs[n];if(t.attributes)for(let n in t.attributes)if("events"===n){for(let n in t.attributes.events){const o=K(t.attributes.events[n],e);r[n]=o}r._root=e,delete t.attributes.events}else{const o=K(t.attributes[n],e);c(r,n,o)}if(void 0===t.text)continue;const o=K(t.text,e);if(2===t.type){const e=r.getAttribute(J);e?X(r,o,e=>t.se.sifrrClone(!0,e),e):I(r,o,e=>t.se.sifrrClone(!0,e)),r.sifrrOldState=o}else if(1===t.type){let e;if(Array.isArray(o))e=o;else if(o.content&&11===o.content.nodeType)e=Array.prototype.slice.call(o.content.childNodes);else if(o.nodeType)e=[o];else if("string"==typeof o){const t=G();t.innerHTML=o.toString(),e=Array.prototype.slice.call(t.content.childNodes)}else e=Array.prototype.slice.call(o);I(r,e)}else r.data!=o&&(r.data=o)}e.onUpdate()};class z{constructor(t,n){if(!e)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,this.url=n}get html(){if(this._html)return this._html;z.add(this.elementName,this);const t=this;return this._html=e.file(this.htmlUrl).then(e=>e.text()).then(e=>l(e).content).then(e=>(t.template=e.querySelector("template"),e)),this._html}get js(){return this._js?this._js:(z.add(this.elementName,this),this._js=e.file(this.jsUrl).then(e=>e.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(e){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,e?this.js.then(e=>{new Function(e+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(e=>(window.console.error(e),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(e=>{e.querySelectorAll("script").forEach(t=>{if(t.src){const e=s.SCRIPT();e.src=t.src,e.type=t.type,window.document.body.appendChild(e)}else new Function(t.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:e.querySelector("template")})})}).catch(e=>{throw e})}static add(e,t){z._all[e]=t}static get all(){return z._all}}z._all={};var Z=z;const{makeChildrenEqual:Q}=U;var V=function e(t){return class extends t{static extends(t){return e(t)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(Z.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||L.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const e=this.constructor.stateMap,t=this.constructor.ctemp.content.cloneNode(!0);this._refs=L.collectRefs(t,e),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){!this.constructor.useShadowRoot&&this.__content&&(Q(this,Array.prototype.slice.call(this.__content.childNodes)),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(e,t,n){"data-sifrr-state"===e&&(this.state=JSON.parse(n)),this.onAttributeChange(e,t,n)}onAttributeChange(){}get state(){return this._state}set state(e){this._state!==e&&Object.assign(this._state,e),this.update(),this.onStateChange()}onStateChange(){}update(){Y(this)}onUpdate(){}isSifrr(e=null){return!e||e===this.constructor.elementName}sifrrClone(e,t){const n=this.cloneNode(e);return n._state=t,n}clearState(){this._state={},this.update()}$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelector(e):this.querySelector(e)}$$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelectorAll(e):this.querySelectorAll(e)}}}(window.HTMLElement);const ee={},te={capture:!0,passive:!0},ne=(e,t)=>Promise.resolve((()=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const o=r[`_${t}`]||(r.getAttribute?r.getAttribute(`_${t}`):null);"function"==typeof o?o.call(r._root||window,e,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),re(e,t,r,n),r=r.parentNode||r.host}})()),re=(e,t,n,r)=>{function o(t){t.forEach(t=>t(e,r,n))}for(let e in ee[t])("function"==typeof n.matches&&n.matches(e)||9===n.nodeType&&"document"===e)&&o(ee[t][e])};var oe={all:ee,add:e=>!ee[e]&&(window.addEventListener(e,t=>ne(t,e),te),ee[e]={},!0),addListener:(e,t,n)=>{const r=ee[e][t]||[];return r.indexOf(n)<0&&r.push(n),ee[e][t]=r,!0},removeListener:(e,t,n)=>{const r=ee[e][t]||[],o=r.indexOf(n);return o>=0&&r.splice(o,1),ee[e][t]=r,!0},trigger:(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e)),e.dispatchEvent(new window.Event(t,Object.assign({bubbles:!0,composed:!0},n)))},opts:te,nativeToSyntheticEvent:ne};let ie={elements:{},loadingElements:[]};return ie.Element=V,ie.Parser=L,ie.Loader=Z,ie.SimpleElement=p,ie.Event=oe,ie.makeEqual=U,ie.template=l,ie.register=((e,t)=>{e.useSR=ie.config.useShadowRoot;const n=e.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",e);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,e,t),ie.elements[n]=e,!0}catch(e){return window.console.error(`Error creating Custom Element: ${n} - ${e.message}`,e.trace),!1}}),ie.setup=function(e){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,ie.config=Object.assign({baseUrl:"",useShadowRoot:!0},e),"string"!=typeof ie.config.baseUrl)throw Error("baseUrl should be a string");ie.Event.add("input"),ie.Event.add("change"),ie.Event.addListener("input","document",ie.Parser.twoWayBind),ie.Event.addListener("change","document",ie.Parser.twoWayBind)},ie.load=function(e,{url:t,js:n=!0}={}){if(window.customElements.get(e))return window.console.warn(`Error loading Element: ${e} - Custom Element with this name is already defined.`);let r=new ie.Loader(e,t);const o=customElements.whenDefined(e);return ie.loadingElements.push(o),r.executeScripts(n).then(()=>{window.customElements.get(e)||window.console.warn(`Executing '${e}' file didn't register the element. Ignore if you are registering element in a promise or async function.`)}).catch(e=>{ie.loadingElements.splice(ie.loadingElements.indexOf(o),1),window.console.error(e)})},ie.loading=(()=>Promise.all(ie.loadingElements)),ie});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
