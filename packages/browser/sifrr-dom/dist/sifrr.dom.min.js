/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const e={parse:t=>{let r={};if("string"==typeof t){try{r=JSON.parse(t)}catch(e){return t}return e.parse(r)}if(Array.isArray(t))r=[],t.forEach((t,n)=>{r[n]=e.parse(t)});else{if("object"!=typeof t)return t;for(const n in t)r[n]=e.parse(t[n])}return r},stringify:t=>"string"==typeof t?t:JSON.stringify(t),shallowEqual:(t,e)=>{for(let r in t)if(!(r in e)||t[r]!=e[r])return!1;for(let r in e)if(!(r in t)||t[r]!=e[r])return!1;return!0},deepClone:t=>{if(Array.isArray(t))return t.map(t=>e.deepClone(t));if("object"!=typeof t||null===t)return t;let r={};for(let n in t)r[n]=e.deepClone(t[n]);return r}};var r=e;var n={updateAttribute:function(t,e,r){const n=t.getAttribute(e);n!=r&&("null"!=r&&"undefined"!=r&&"false"!=r&&r?t.setAttribute(e,r):n&&t.removeAttribute(e)),"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=r)}};const s=window.document.createElement("template");var o={TEMPLATE:()=>s.cloneNode(),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1};const{updateAttribute:a}=n,{shallowEqual:i}=r,{TEXT_NODE:l,COMMENT_NODE:c}=o;function u(t,e){const r=t.childNodes.length,n=e.length;if(r>n){let e=r;for(;e>n;)t.removeChild(t.lastChild),e--}else if(r<n){let s=r;for(;s<n;)t.appendChild(e[s]),s++}const s=Math.min(n,r);for(let r,n=0,o=t.firstChild;n<s;n++)o=d(o,r=e[n]).nextSibling}function d(t,e){if(null===e)return t;if("stateChange"===e.type)return i(t.state,e.state)||(t.state=e.state),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===l||t.nodeType===c)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);let r,n=t.attributes,s=e.attributes;for(let e=s.length-1;e>=0;--e)a(t,s[e].name,s[e].value);for(let s=n.length-1;s>=0;--s)r=n[s],e.hasAttribute(r.name)||!1===r.specified||t.removeAttribute(r.name);return u(t,e.childNodes),t}var h={makeEqual:d,makeChildrenEqual:u};const f=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);f.roll=function(t,e=!1){let r=this.currentNode;for(;--t;)r=e&&e(r)?f.nextSibling()||f.parentNode():f.nextNode();return r};class m{constructor(t,e){this.idx=t,this.ref=e}}var p={walker:f,collect:function(t,e=t.stateMap,r){const n=[];return f.currentNode=t,e.map(t=>n.push(f.roll(t.idx,r))),n},create:function(t,e,r=!1){let n,s=[],o=0;for(f.currentNode=t;t;)(n=e(t))?(s.push(new m(o+1,n)),o=1):o++,t=r&&r(t)?f.nextSibling()||f.parentNode():f.nextNode();return s},Ref:m};const{makeChildrenEqual:g}=h,{updateAttribute:w}=n,{collect:y,create:E}=p,{TEXT_NODE:b,COMMENT_NODE:_,ELEMENT_NODE:S}=o,v=o.TEMPLATE();function N(t){return t.dataset&&"true"==t.dataset.sifrrHtml||"true"==t.contentEditable||"TEXTAREA"==t.nodeName||"STYLE"==t.nodeName||t.dataset&&t.dataset.sifrrRepeat}function T(t){if(t.nodeType===b||t.nodeType===_){const e=t.nodeValue;if(e.indexOf("${")>-1)return{html:!1,text:e.trim()}}else if(t.nodeType===S){const e={};if(N(t)){const r=t.innerHTML;r.indexOf("${")>=0&&(e.html=!0,e.text=r.replace(/<!--(.*)-->/g,"$1"))}const r=t.attributes||[],n=r.length,s={events:{}};for(let t=0;t<n;t++){const e=r[t];if("$"===e.name[0])s.events[e.name]=e.value;else if(e.value.indexOf("${")>=0)if("style"===e.name){const t={};e.value.split(";").forEach(e=>{const[r,n]=e.split(/:(?!\/\/)/);r&&n&&n.indexOf("${")>=0&&(t[r.trim()]=n.trim())}),s[e.name]=t}else s[e.name]=e.value}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(e.attributes=s),Object.keys(e).length>0)return e}return 0}const C={collectRefs:(t,e)=>y(t,e,N),createStateMap:t=>E(t,T,N),update:t=>{if(!t._refs)return!1;const e=t._refs.length;for(let r=0;r<e;r++){const e=t.constructor.stateMap[r].ref,n=t._refs[r];if(e.attributes)for(let r in e.attributes)if("events"===r)for(let r in e.attributes.events){const s=C.evaluateString(e.attributes.events[r],t,!0);"${this"===e.attributes.events[r].slice(0,6)?n[r]=s.bind(t):n[r]=s}else if("style"===r)for(let r in e.attributes.style)n.style[r]=C.evaluateString(e.attributes.style[r],t);else{const s=C.evaluateString(e.attributes[r],t);w(n,r,s)}if(void 0===e.html)continue;const s=C.evaluateString(e.text,t);if(s)if(e.html){let t;Array.isArray(s)?t=s:s.nodeType?t=[s]:(v.innerHTML=s.toString().replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"),t=Array.prototype.slice.call(v.content.childNodes)),t.length<1?n.textContent="":g(n,t)}else n.nodeValue!=s&&(n.nodeValue=s);else n.textContent=""}},twoWayBind:t=>{const e=t.path?t.path[0]:t.target;if(!e.dataset.sifrrBind)return;const r=void 0===e.value?e.innerHTML:e.value;let n,s={};if(e._root)n=e._root;else{for(n=e;!n.isSifrr;)n=n.parentNode||n.host;e._root=n}s[e.dataset.sifrrBind]=r,n.state=s},evaluateString:(t,e)=>{return t.indexOf("${")<0?t:(t=t.trim()).match(/^\${([^{}$]|{([^{}$])*})*}$/)?r(t):r("`"+t+"`");function r(t){let r;return"$"==t[0]&&(t=t.slice(2,-1)),(r=t.indexOf("return ")>=0?new Function(t).bind(e):new Function("return "+t).bind(e))()}}};var x=C;const{TEMPLATE:A}=o;var $=(t,...e)=>{const r=A();if("string"==typeof t);else{if(!t[0]||"string"!=typeof t[0])return t[0]?(Array.from(t).forEach(t=>{r.content.appendChild(t)}),r):t;t=String.raw(t,...e)}return t=t.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/\n\s+/g,"").replace(/(\\)?\$(\\)?\{/g,"${"),r.innerHTML=t,r};class O{constructor(e,r){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=r}get html(){if(this._html)return this._html;O.add(this.elementName,this);const e=this;return this._html=t.file(this.htmlUrl).then(t=>t.text()).then(t=>$(t).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(O.add(this.elementName,this),this._js=t.file(this.jsUrl).then(t=>t.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){return this._executed?window.console.log(`${this.elementName} was already executed`):(this._executed=!0,t?this.js.then(t=>{new Function(t).bind(window)()}).catch(t=>(window.console.error(t),window.console.log(`JS file gave error. Trying to get html file for ${this.elementName}.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(t=>{if(t.src){const e=window.document.createElement("script");e.src=t.src,e.type=t.type,window.document.querySelector("head").appendChild(e)}else new Function(t.text).bind(window)()})}).catch(t=>window.console.error(t))}static add(t,e){O._all[t]=e}static get all(){return O._all}}O._all={};var M=O;const{collect:L,create:j}=p;function D(t){if(3!==t.nodeType){if(void 0!==t.attributes){const e=Array.from(t.attributes),r=e.length,n=[];for(let s=0;s<r;s++){const r=e[s].value;"$"===r[0]&&(n.push({name:e[s].name,text:r.slice(2,-1)}),t.setAttribute(e[s].name,""))}if(n.length>0)return n}return 0}{let e=t.nodeValue;return"$"===e[0]?(t.nodeValue="",e.slice(2,-1)):0}}function R(t){const e=t._refs,r=t.stateMap,n=r.length,s=t.state,o=t._oldState;for(let t=0;t<n;t++){const n=r[t].ref,a=e[t];if(Array.isArray(n)){const t=n.length;for(let e=0;e<t;e++){const t=n[e];o[t.text]!==s[t.text]&&("class"===t.name?a.className=s[t.text]:a.setAttribute(t.name,s[t.text]))}}else o[n]!=s[n]&&(a.nodeValue=s[n])}}var k=function(t,e){if("string"==typeof t){const e=$(t);t=e.content.firstElementChild||e.content.firstChild}else if(!t.nodeType)throw TypeError("First argument for SimpleElement should be of type string or DOM element");return-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&t.getAttribute("is").indexOf("-")>=0||t.isSifrr?t:(t.stateMap=j(t,D),t._refs=L(t,t.stateMap),Object.defineProperty(t,"state",{get:()=>t._state,set:e=>{t._oldState=Object.assign({},t._state),t._state=Object.assign(t._state||{},e),R(t)}}),e&&(t.state=e),t.sifrrClone=function(e=!0){const r=t.cloneNode(e);return r.stateMap=t.stateMap,r._refs=L(r,t.stateMap),Object.defineProperty(r,"state",{get:()=>r._state,set:t=>{r._oldState=Object.assign({},r._state),r._state=Object.assign(r._state||{},t),R(r)}}),t.state&&(r.state=t.state),r},t)};var q=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){const t=(M.all[this.elementName]||{template:!1}).template;return window.ShadyCSS&&this.useShadowRoot&&window.ShadyCSS.prepareTemplate(t,this.elementName),t}static get ctemp(){return this._ctemp=this._ctemp||this.template,this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||x.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static onStateChange(){}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){(this.constructor.defaultState||this.state)&&(this._state=Object.assign({},this.constructor.defaultState,this.state));const t=this.constructor.ctemp.content.cloneNode(!0);this.constructor.useShadowRoot?(this._refs=x.collectRefs(t,this.constructor.stateMap),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t),this.shadowRoot.addEventListener("change",x.twoWayBind)):this.__content=t}}connectedCallback(){this.constructor.useShadowRoot?!this.hasAttribute("data-sifrr-state")&&this._state&&this.update():(this.textContent="",this._refs=x.collectRefs(this.__content,this.constructor.stateMap),this.appendChild(this.__content),(this._state||this.hasAttribute("data-sifrr-state"))&&this.update()),this.onConnect()}onConnect(){}disconnectedCallback(){this.shadowRoot&&this.shadowRoot.removeEventListener("change",x.twoWayBind),this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){"data-sifrr-state"===t&&(this.state=r.parse(n)),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){this._state=this._state||{},this._state!==t&&Object.assign(this._state,t),this.update()}update(){x.update(this),this.onStateChange(),this.constructor.onStateChange(this)}onStateChange(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t){return this.cloneNode(t)}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}static addArrayToDom(t,e){this._arrayToDom=this._arrayToDom||{},this._arrayToDom[this.elementName]=this._arrayToDom[this.elementName]||{},this._arrayToDom[this.elementName][t]=k(e)}arrayToDom(t,e=this.state[t]){this._domL=this._domL||{};const r=this._domL[t]||0,n=[],s=e.length;let o;try{o=this.constructor._arrayToDom[this.constructor.elementName][t]}catch(e){return window.console.error(`[error]: No arrayToDom data of '${t}' added in ${this.constructor.elementName}.`)}for(let t=0;t<s;t++)if(t<r)n.push({type:"stateChange",state:e[t]});else{const r=o.sifrrClone(!0);r.state=e[t],n.push(r)}return this._domL[t]=s,n}}}(window.HTMLElement);const P={},H=(t,e,r,n)=>{function s(e){e.forEach(e=>e(t,n,r))}for(let t in P[e])("function"==typeof r.matches&&r.matches(t)||9===r.nodeType&&"document"===t)&&s(P[e][t])};var U={all:P,add:t=>!P[t]&&(window.addEventListener(t,e=>((t,e)=>Promise.resolve((()=>{const r=t.composedPath?t.composedPath()[0]:t.target;let n=r;for(;n;){const s=n[`$${e}`];s&&s(t,r),H(t,e,n,r),n=n.parentNode||n.host}})()))(e,t),{capture:!0,passive:!0}),P[t]={},!0),addListener:(t,e,r)=>{const n=P[t][e]||[];return n.indexOf(r)<0&&n.push(r),P[t][e]=n,!0},removeListener:(t,e,r)=>{const n=P[t][e]||[],s=n.indexOf(r);return s>=0&&n.splice(s,1),P[t][e]=n,!0},trigger:(t,e,r)=>{t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},r)))}};let F={elements:{},loadingElements:[]};return F.Element=q,F.Parser=x,F.Loader=M,F.SimpleElement=k,F.Event=U,F.makeEqual=h,F.Json=r,F.template=$,F.register=((t,e)=>{t.useSR=F.config.useShadowRoot;const r=t.elementName;if(!r)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(r))window.console.warn(`Error creating Element: ${r} - Custom Element with this name is already defined.`);else{if(r.indexOf("-")<1)throw Error(`Error creating Element: ${r} - Custom Element name must have one dash '-'`);try{return window.customElements.define(r,t,e),F.elements[r]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${r} - ${t.message}`,t.trace),!1}}return!1}),F.setup=function(t){if(F.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),"string"!=typeof F.config.baseUrl)throw Error("baseUrl should be a string");F.Event.add("input"),F.Event.add("change"),F.Event.addListener("change","document",F.Parser.twoWayBind),F.Event.addListener("input","document",F.Parser.twoWayBind)},F.load=function(t,{url:e,js:r=!0}={}){let n=new F.Loader(t,e);return F.loadingElements.push(customElements.whenDefined(t)),n.executeScripts(r)},F.loading=(()=>Promise.all(F.loadingElements)),F});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
