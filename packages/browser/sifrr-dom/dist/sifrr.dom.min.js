/*! Sifrr.Dom v0.1.0-alpha - sifrr project - 2018/12/13 20:11:22 UTC */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.Sifrr=t.Sifrr||{},t.Sifrr.Dom=e())}(this,function(){"use strict";class t{constructor(e,r){this.baseElement=e,this.html=r,this.originalVdom=t.toVdom(r)}updateState(){}newVdom(){}static toVdom(e){if(Array.isArray(e)){let r=[];for(;e.length;)r.push(t.toVdom(e.shift()));return r}if(3===e.nodeType)return{tag:"#text",data:e.nodeValue,dom:e};const r=e.attributes||[],n=r.length;let a={};for(let t=0;t<n;t++)a[r[t].name]=r[t].value;return{tag:e.nodeName,attrs:a,children:t.toVdom(Array.prototype.slice.call(e.childNodes)),dom:e}}static toHtml(e){if(!e)return e;if(Array.isArray(e)){let r=[];for(;e.length;)r.push(t.toHtml(e.shift()));return r}if(e.dom)return e.dom;let r;switch(e.tag){case"#text":r=document.createTextNode(e.data);break;case"#comment":r=document.createComment("comment");break;default:r=document.createElement(e.tag);for(let t in e.attrs)r.setAttribute(t,e.attrs[t]);r.append(...t.toHtml(e.children))}return r}}var e=t;const r={sifrrNode:window.document.createElement("sifrr-node"),createStateMap:function(t,e=t.shadowRoot){t.stateMap=r._createStateMap(e)},_createStateMap:function(t){let e=[],n=[];if(Array.isArray(t)){for(;t.length;){const a=r._createStateMap(t.shift());Array.prototype.push.apply(e,a.nodes),Array.prototype.push.apply(n,a.attributes)}return{nodes:e,attributes:n}}if(3===t.nodeType)return r.createTextStateMap(t);Array.prototype.push.apply(n,r.createAttributeStateMap(t));const a=r._createStateMap(Array.prototype.slice.call(t.childNodes));return Array.prototype.push.apply(e,a.nodes),Array.prototype.push.apply(n,a.attributes),{nodes:e,attributes:n}},createTextStateMap:function(t){const r=t.nodeValue;let n=[];return r.indexOf("${")>-1&&("true"!=t.parentNode.contentEditable&&t.parentNode.dataset&&"true"==t.parentNode.dataset.sifrrHtml?(n.push({tag:t.parentNode.nodeName,data:t.parentNode.innerHTML,dom:t.parentNode}),t.parentNode.originalVdom=e.toVdom(t.parentNode)):"true"==t.parentNode.contentEditable||"TEXTAREA"==t.parentNode.nodeName||"STYLE"==t.parentNode.nodeName?n.push({tag:t.parentNode.nodeName,data:r,dom:t.parentNode}):n.push({tag:"#text",data:r,dom:t})),{nodes:n,attributes:[]}},createAttributeStateMap:function(t){const e=t.attributes||[],r=e.length;let n=[];for(let a=0;a<r;a++){const r=e[a];r.value.indexOf("${")>-1&&n.push({name:r.name,value:r.value,dom:t})}return n},twoWayBind:function(t){const e=t.path?t.path[0]:t.target;if(!e.dataset.sifrrBind)return;const r=void 0===e.value?e.innerHTML:e.value;let n={};n[e.dataset.sifrrBind]=r,e.getRootNode().host.state=n},updateState:async function(t){if(!t.stateMap)return!1;const e=t.stateMap.nodes,n=e.length;for(let a=0;a<n;a++)r.updateNode(e[a],t);const a=t.stateMap.attributes,o=a.length;for(let e=0;e<o;e++)r.updateAttribute(a[e],t)},updateNode:function(t,e){const n=t.dom.innerHTML,a=r.evaluateString(t.data,e);if(n!=a)return void 0===a?t.dom.textContent="":void(Array.isArray(a)&&a[0]&&a[0].nodeType?(t.dom.innerHTML="",t.dom.append(...a)):a.nodeType?(t.dom.innerHTML="",t.dom.appendChild(a)):t.dom.dataset&&"true"==t.dom.dataset.sifrrHtml?t.dom.innerHTML=a.toString().replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(input|link|img|br|hr|col|keygen)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"):"TEXTAREA"==t.dom.nodeName?t.dom.value!==a&&(t.dom.value=a):t.dom.textContent!==a&&(t.dom.textContent=a.toString()))},updateAttribute:function(t,e){const n=r.evaluateString(t.value,e);t.dom.setAttribute(t.name,n),"SELECT"==t.dom.nodeName&&"value"==t.name&&(t.dom.value=n)},evaluateString:function(t,e){return t.indexOf("${")<0?t:(t=t.trim()).match(/^\${([^{}$]|{([^{}$])*})*}$/)?r(t):r("`"+t+"`");function r(t){let r;return"$"==t[0]&&(t=t.slice(2,-1)),(r=t.search("return")>=0?new Function(t).bind(e):new Function("return "+t).bind(e))()}}};var n=r;var a=class{static parse(t){let e={};if("string"==typeof t){try{e=JSON.parse(t)}catch(e){return t}return this.parse(e)}if(Array.isArray(t))e=[],t.forEach((t,r)=>{e[r]=this.parse(t)});else{if("object"!=typeof t)return t;for(const r in t)e[r]=this.parse(t[r])}return e}static stringify(t){return"string"==typeof t?t:JSON.stringify(t)}};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var o,s=(function(t,e){var r;t.exports=(r=class{constructor(t,e,r){this.type=t,this._options=r,this._url=e}get response(){return window.fetch(this.url,this.options).then(t=>{let e=t.headers.get("content-type");if(e&&e.includes("application/json")&&(t=t.json()),t.ok)return t;{let e=Error(t.statusText);throw e.response=t,e}})}get url(){let t=delete this._options.params;return t&&Object.keys(t).length>0?this._url+"?"+Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&"):this._url}get options(){return Object.assign(this._options,{method:this.type,headers:Object.assign({accept:"application/json"},this._options.headers||{}),mode:"cors",redirect:"follow"})}},class{static get(t,e={}){return new r("GET",t,e).response}static post(t,e={}){return new r("POST",t,e).response}static put(t,e={}){return new r("PUT",t,e).response}static delete(t,e={}){return new r("DELETE",t,e).response}static file(t,e={}){return e.headers=e.headers||{},e.headers.accept=e.headers.accept||"*/*",new r("GET",t,e).response}})}(o={exports:{}},o.exports),o.exports);class i{constructor(t){if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t}get html(){const t=this;return s.file(this.htmlUrl).then(t=>t.text()).then(t=>(new window.DOMParser).parseFromString(t,"text/html")).then(e=>(i.add(t.elementName,e.querySelector("template")),e))}get htmlUrl(){return`/elements/${this.elementName.split("-").join("/")}.html`}executeScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(t=>{new Function(t.text).bind(window)()})})}static add(t,e){i._all[t]=e}static get all(){return i._all}}i._all={};var d=i;var l=class extends window.HTMLElement{static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs||[])}static get template(){return d.all[this.elementName]}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}constructor(){super(),this._state=Object.assign({},this.constructor.defaultState,a.parse(this.dataset.sifrrState),this.state),this.attachShadow({mode:"open"});const t=this.constructor.template.content.cloneNode(!0);n.createStateMap(this,t),this.shadowRoot.appendChild(t),this.shadowRoot.addEventListener("change",n.twoWayBind)}connectedCallback(){n.updateState(this)}disconnectedCallback(){this.shadowRoot?this.shadowRoot.removeEventListener("change",n.twoWayBind):this.removeEventListener("change",n.twoWayBind)}attributeChangedCallback(t,e,r){"data-sifrr-state"===t&&(this.state=a.parse(r))}get state(){return this._state}set state(t){Object.assign(this._state,t),n.updateState(this)}isSifrr(t=null){return!t||t==this.constructor.elementName}clearState(){this._state={},n.updateState(this)}srqs(t){return this.shadowRoot.querySelector(t)}srqsAll(t){return this.shadowRoot.querySelectorAll(t)}};const c={};let u={elements:{}};return u.Element=l,u.Parser=n,u.Vdom=e,u.Loader=d,u.register=function(t){const e=t.elementName;if(e)if(window.customElements.get(e))window.console.warn(`Error creating Element: ${e} - Custom Element with this name is already defined.`);else if(e.indexOf("-")<1)window.console.warn(`Error creating Element: ${e} - Custom Element name must have one dash '-'`);else try{return window.customElements.define(e,t),u.elements[e]=t,!0}catch(t){return window.console.warn(`Error creating Custom Element: ${e} - ${t}`),!1}else window.console.warn("Error creating Custom Element: No name given.",t);return!1},u.addSifrrEvent=(t=>{c[t]||(document.addEventListener(t,e=>((t,e)=>{let r=t.target;for(;null!==r;){const t=r[`$${e}`];if(t)return void t();r=r.parentNode}})(e,t)),c[t]=!0)}),u.setup=function(){window.document.addEventListener("input",u.Parser.twoWayBind,{capture:!0,passive:!0}),window.document.addEventListener("blur",u.Parser.twoWayBind,{capture:!0,passive:!0})},u.load=function(t){new u.Loader(t).executeScripts()},u});
/*! (c) @aadityataparia */
