/*! Sifrr.Dom v0.1.0-alpha - sifrr project - 2018/12/18 0:37:38 UTC */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.Sifrr=e.Sifrr||{},e.Sifrr.Dom=t())}(this,function(){"use strict";function e(e,n){if(0===n.length)return void(e.textContent="");let r=e.childNodes.length;if(r>n.length){let t,o=r,a=e.lastChild;for(;o>n.length;)t=a.previousSibling,e.removeChild(a),a=t,o--}let o=e.firstChild;for(let r,a=0;a<n.length;a++)r=n[a],o?o=t(o,r).nextSibling:(e.appendChild(r),a--)}function t(t,n){if(t.nodeName!==n.nodeName)return t.replaceWith(n),n;if(t.nodeType===window.Node.TEXT_NODE||t.nodeType===window.Node.COMMENT_NODE)return t.nodeValue!==n.nodeValue&&(t.nodeValue=n.nodeValue),t;let r,o,a,s,i=t.attributes,d=n.attributes;for(var l=d.length-1;l>=0;--l)a=(s=d[l]).name,r=s.value,t.hasAttribute(a)?(o=t.getAttribute(a))!==r&&("null"===r||"undefined"===r?t.removeAttribute(a):t.setAttribute(a,r)):t.setAttribute(a,r);for(var u=i.length-1;u>=0;--u)!1!==(s=i[u]).specified&&(a=s.name,n.hasAttributeNS(null,a)||t.removeAttribute(a));return t.state=n.state,e(t,n.childNodes),t}var n={makeEqual:t,makeChildrenEqual:e};const{makeChildrenEqual:r}=n,o={sifrrNode:window.document.createElement("sifrr-node"),createStateMap:function(e,t=e.shadowRoot){let n,r=[],a=[];const s=document.createTreeWalker(t,NodeFilter.SHOW_ALL);for(;s.nextNode();)if((n=s.currentNode).nodeType===window.Node.TEXT_NODE){const e=o.createTextStateMap(n);e&&r.push(e)}else if(n.nodeType===window.Node.COMMENT_NODE){const e=o.createTextStateMap(n);e&&r.push(e)}else if(n.nodeType===window.Node.ELEMENT_NODE){const e=o.createAttributeStateMap(n);e&&a.push(e)}e.stateMap={nodes:r,attributes:a}},createTextStateMap:function(e){const t=e.nodeValue;if(t.indexOf("${")>-1)return"true"!=e.parentNode.contentEditable&&e.parentNode.dataset&&"true"==e.parentNode.dataset.sifrrHtml?{tag:e.parentNode.nodeName,data:e.parentNode.innerHTML,dom:e.parentNode}:"true"==e.parentNode.contentEditable||"TEXTAREA"==e.parentNode.nodeName||"STYLE"==e.parentNode.nodeName?{tag:e.parentNode.nodeName,data:e.parentNode.innerHTML,dom:e.parentNode}:{tag:"#text",data:t,dom:e}},createAttributeStateMap:function(e){const t=e.attributes||[],n=t.length;let r={};for(let e=0;e<n;e++){const n=t[e];n.value.indexOf("${")>-1&&(r[n.name]=n.value)}if(Object.keys(r).length>0)return{element:e,attributes:r}},twoWayBind:function(e){const t=e.path?e.path[0]:e.target;if(!t.dataset.sifrrBind)return;const n=void 0===t.value?t.innerHTML:t.value;let r={};r[t.dataset.sifrrBind]=n,t.getRootNode().host.state=r},updateState:function(e){if(!e.stateMap)return!1;const t=e.stateMap.nodes,n=t.length;for(let r=0;r<n;r++)o.updateNode(t[r],e);const r=e.stateMap.attributes,a=r.length;for(let t=0;t<a;t++)o.updateAttribute(r[t],e)},updateNode:function(e,t){const n=e.dom.innerHTML,a=o.evaluateString(e.data,t);if(n!=a){if(void 0===a)return e.dom.textContent="";if(Array.isArray(a)&&a[0]&&a[0].nodeType)r(e.dom,a);else if(a.nodeType)r(e.dom,[a]);else if(e.dom.dataset&&"true"==e.dom.dataset.sifrrHtml){const t=o.sifrrNode.cloneNode();t.innerHTML=a.toString().replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/(&lt;)(((?!&gt;).)*)(&gt;)(((?!&lt;).)*)(&lt;)\/(((?!&gt;).)*)(&gt;)/g,"<$2>$5</$8>").replace(/(&lt;)(input|link|img|br|hr|col|keygen)(((?!&gt;).)*)(&gt;)/g,"<$2$3>"),r(e.dom,t.childNodes)}else"TEXTAREA"==e.dom.nodeName?e.dom.value!==a&&(e.dom.value=a):"true"==e.dom.contentEditable?e.dom.innerHTML!==a&&(e.dom.innerHTML=a):e.dom.textContent!==a&&(e.dom.textContent=a.toString())}},updateAttribute:function(e,t){const n=e.element;for(let r in e.attributes){const a=o.evaluateString(e.attributes[r],t);n.setAttribute(r,a),"SELECT"==n.nodeName&&"value"==r&&(n.value=a)}},evaluateString:function(e,t){return e.indexOf("${")<0?e:(e=e.trim()).match(/^\${([^{}$]|{([^{}$])*})*}$/)?n(e):n("`"+e+"`");function n(e){let n;return"$"==e[0]&&(e=e.slice(2,-1)),(n=e.search("return")>=0?new Function(e).bind(t):new Function("return "+e).bind(t))()}}};var a=o;var s=class{static parse(e){let t={};if("string"==typeof e){try{t=JSON.parse(e)}catch(t){return e}return this.parse(t)}if(Array.isArray(e))t=[],e.forEach((e,n)=>{t[n]=this.parse(e)});else{if("object"!=typeof e)return e;for(const n in e)t[n]=this.parse(e[n])}return t}static stringify(e){return"string"==typeof e?e:JSON.stringify(e)}};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var i,d=(function(e,t){var n;e.exports=(n=class{constructor(e,t,n){this.type=e,this._options=n,this._url=t}get response(){return window.fetch(this.url,this.options).then(e=>{let t=e.headers.get("content-type");if(t&&t.includes("application/json")&&(e=e.json()),e.ok)return e;{let t=Error(e.statusText);throw t.response=e,t}})}get url(){let e=delete this._options.params;return e&&Object.keys(e).length>0?this._url+"?"+Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"):this._url}get options(){return Object.assign(this._options,{method:this.type,headers:Object.assign({accept:"application/json"},this._options.headers||{}),mode:"cors",redirect:"follow"})}},class{static get(e,t={}){return new n("GET",e,t).response}static post(e,t={}){return new n("POST",e,t).response}static put(e,t={}){return new n("PUT",e,t).response}static delete(e,t={}){return new n("DELETE",e,t).response}static file(e,t={}){return t.headers=t.headers||{},t.headers.accept=t.headers.accept||"*/*",new n("GET",e,t).response}})}(i={exports:{}},i.exports),i.exports);class l{constructor(e){if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e}get html(){const e=this;return d.file(this.htmlUrl).then(e=>e.text()).then(e=>(new window.DOMParser).parseFromString(e,"text/html")).then(t=>(l.add(e.elementName,t.querySelector("template")),t))}get htmlUrl(){return`/elements/${this.elementName.split("-").join("/")}.html`}executeScripts(){return this.html.then(e=>{e.querySelectorAll("script").forEach(e=>{new Function(e.text).bind(window)()})})}static add(e,t){l._all[e]=t}static get all(){return l._all}}l._all={};var u=l;var c=class extends window.HTMLElement{static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs||[])}static get template(){return u.all[this.elementName]}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}constructor(){super(),this._state=Object.assign({},this.constructor.defaultState,s.parse(this.dataset.sifrrState),this.state),this.attachShadow({mode:"open"});const e=this.constructor.template.content.cloneNode(!0);a.createStateMap(this,e),this.shadowRoot.appendChild(e),this.shadowRoot.addEventListener("change",a.twoWayBind)}connectedCallback(){a.updateState(this)}disconnectedCallback(){this.shadowRoot?this.shadowRoot.removeEventListener("change",a.twoWayBind):this.removeEventListener("change",a.twoWayBind)}attributeChangedCallback(e,t,n){"data-sifrr-state"===e&&(this.state=s.parse(n))}get state(){return this._state}set state(e){Object.assign(this._state,e),a.updateState(this)}isSifrr(e=null){return!e||e==this.constructor.elementName}clearState(){this._state={},a.updateState(this)}srqs(e){return this.shadowRoot.querySelector(e)}srqsAll(e){return this.shadowRoot.querySelectorAll(e)}};const p={};let h={elements:{}};return h.Element=c,h.Parser=a,h.makeEqual=n,h.Loader=u,h.register=function(e){const t=e.elementName;if(t)if(window.customElements.get(t))window.console.warn(`Error creating Element: ${t} - Custom Element with this name is already defined.`);else if(t.indexOf("-")<1)window.console.warn(`Error creating Element: ${t} - Custom Element name must have one dash '-'`);else try{return window.customElements.define(t,e),h.elements[t]=e,!0}catch(e){return window.console.warn(`Error creating Custom Element: ${t} - ${e}`),!1}else window.console.warn("Error creating Custom Element: No name given.",e);return!1},h.addEvent=(e=>{p[e]||(window.document.addEventListener(e,t=>((e,t)=>{let n=e.target;for(;null!==n;){const r=n[`$${t}`];r&&r(e,t),n=n.parentNode}})(t,e),{capture:!0,passive:!0}),p[e]=!0)}),h.setup=function(){h.addEvent("input"),h.addEvent("blur"),window.document.$input=h.Parser.twoWayBind,window.document.$blur=h.Parser.twoWayBind},h.load=function(e){new h.Loader(e).executeScripts()},h});
/*! (c) @aadityataparia */
