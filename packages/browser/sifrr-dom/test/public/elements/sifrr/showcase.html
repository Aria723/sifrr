<template>
  <style media="screen">
    * {
      box-sizing: border-box;
    }
    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-wrap: nowrap;
    }
    #sidebar {
      width: 30%;
      height: 100%;
    }
    #sidebar > * {
      height: 33.33%;
    }
    #main {
      width: 70%;
      height: 100%;
    }
    .flex-column {
      height: 100%;
      display: flex;
      flex-wrap: nowrap;
      flex-direction: column;
    }
    .box {
      width: 100%;
      border: 1px solid grey;
      overflow: scroll;
    }
    #element {
      background-color: grey;
      padding: 20px;
      height: 70%;
    }
    #element > * {
      display: block;
      background-color: white;
      margin: auto;
      ${this.state.style}
    }
    #code {
      height: 30%;
    }
    #code highlight-syntax {
      height: calc(100% - 48px) !important;
    }
    label {
      font-family: Roboto, Ariel;
      font-size: 16px;
      line-height: 24px;
      padding: 4px;
    }
    highlight-syntax {
      width: 100%;
      height: calc(100% - 24px);
      font-size: 14px;
      padding: 4px;
    }
  </style>
  <div class="container">
    <div class="flex-column" id="sidebar">
      <div class="box">
        <label for="style">CSS Styles</label>
        <highlight-syntax lang='css' data-sifrr-bind="style" value="${this.state.style}"></highlight-syntax>
      </div>
      <div class="box">
        <label for="elState">Element State Function</label>
        <highlight-syntax id="elState" lang='js' data-sifrr-bind="elState" value="${this.state.elState}"></highlight-syntax>
      </div>
      <div class="box">
        <label for="states">Styles</label>
        <button type="button" name="createStyle">Create new style</button>
        <button type="button" name="saveStyle">Save style</button>
        <div id="#styles">
          <ul data-sifrr-repeat="${this.state.styles}">
            <li>${this.state.name}</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="flex-column" id="main">
      <div class="box" id="element" data-sifrr-html="true">
        ${this.state.code}
      </div>
      <div class="box" id="code">
        <label for="elementName">Element Name</label>
        <input type="text" name="elementName" _input="${this.updateHtml}" value="${this.state.element}">
        <label for="elementName">Is JS File</label>
        <select id="isjs" name="isjs" value="${this.isjs.toString()}" _input='${this.update}'>
          <option value="true">true</option>
          <option value="false">false</option>
        </select>
        <br>
        <label for="htmlcode">HTML Code</label>
        <highlight-syntax lang='html' data-sifrr-bind="code" value="${this.state.code}"></highlight-syntax>
      </div>
    </div>
  </div>
</template>
<script type="text/javascript">
  class SifrrShowcase extends Sifrr.Dom.Element {
    onUpdate() {
      if (this._element !== this.state.element || this._js !== this.isjs) {
        Sifrr.Dom.load(this.state.element, { js: this.isjs });
        this._js = this.isjs;
        this._element = this.state.element;
      }
      let state;
      try {
        state = new Function(this.$('#elState').value).call(this.element());
      } catch (e) {
        console.warn(e);
      }
      if (state && this.element() && this.element().isSifrr && this.element().state !== state) {
        this.element().state = state;
      }
    }

    updateHtml(e, el) {
      const html = `<${el.value}></${el.value}>`;
      this.state = { code: html, element: el.value };
    }

    element() {
      return this.$('#element').firstElementChild;
    }

    get isjs() {
      return JSON.parse(this.$('#isjs').value);
    }
  }

  SifrrShowcase.defaultState = {
    element: 'highlight-syntax',
    style: 'width: 100%;\nheight: 500px;',
    code: '<highlight-syntax>\n</highlight-syntax>',
    elState: 'return {}',
    styles: [{ name: 'new' }]
  };

  Sifrr.Dom.register(SifrrShowcase, { dependsOn: 'highlight-syntax' });
</script>