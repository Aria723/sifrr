{"version":3,"file":"sifrr.seo.module.js","sources":["../src/pagerequest.js","../src/constants.js","../src/renderer.js","../src/getcache.js","../src/middleware.js","../src/sifrr.seo.js"],"sourcesContent":["const whiteTypes = ['document', 'script', 'xhr', 'fetch'];\n\nfunction isTypeOf(request, types) {\n  const resType = request.resourceType();\n  return types.indexOf(resType) !== -1;\n}\n\nclass PageRequest {\n  constructor(npage, filter = () => true) {\n    this.npage = npage;\n    this.filter = filter;\n    this.pendingRequests = 0;\n    this.pendingPromise = new Promise(res => this.pendingResolver = res);\n    this.addOnRequestListener();\n    this.addEndRequestListener();\n  }\n\n  addOnRequestListener() {\n    const me = this;\n    this.addListener = this.npage.setRequestInterception(true).then(() => {\n      me.npage.on('request', (request) => {\n        if (isTypeOf(request, whiteTypes) && this.filter(request.url())) {\n          me.pendingRequests++;\n          request.__allowed = true;\n          request.continue();\n        } else {\n          request.__allowed = false;\n          request.abort();\n        }\n      });\n    });\n  }\n\n  addEndRequestListener() {\n    // resolve pending fetch/xhrs\n    const me = this;\n    this.npage.on('requestfailed', request => {\n      me.onEnd(request);\n    });\n    this.npage.on('requestfinished', request => {\n      me.onEnd(request);\n    });\n  }\n\n  onEnd(request) {\n    if (request.__allowed) {\n      this.pendingRequests--;\n      if (this.pendingRequests === 0)this.pendingResolver();\n    }\n  }\n\n  all() {\n    if (this.pendingRequests === 0) return Promise.resolve(true);\n    return this.pendingPromise;\n  }\n}\n\nmodule.exports = PageRequest;\n","module.exports = {\n  noop: () => {},\n  headerName: 'X-SSR-Powered-By',\n  headerValue: '@sifrr/seo'\n};\n","const puppeteer = require('puppeteer');\nconst PageRequest = require('./pagerequest');\nconst { noop } = require('./constants');\n\nclass Renderer {\n  constructor(puppeteerOptions = {}, options = {}) {\n    this.launched = false;\n    this.puppeteerOptions = Object.assign({\n      headless: true,\n      args: [],\n    }, puppeteerOptions);\n    this.puppeteerOptions.args.push(\n      '--no-sandbox',\n      '--disable-setuid-sandbox'\n    );\n    this.options = Object.assign({\n      beforeRender: noop,\n      afterRender: noop\n    }, options);\n  }\n\n  async launchBrowser() {\n    this.browser = await puppeteer.launch(this.puppeteerOptions);\n    this.launched = true;\n    const me = this;\n    this.browser.on('disconnected', () => {\n      /* istanbul ignore next */\n      me.launched = false;\n    });\n  }\n\n  close() {\n    if (this.launched) return this.browser.close();\n    else return Promise.resolve(true);\n  }\n\n  render(req) {\n    const fullUrl = req.fullUrl;\n    let pro = Promise.resolve(true);\n    const me = this;\n\n    if (!this.launched) pro = this.launchBrowser();\n    return pro.then(() => this.browser.newPage()).then(async (newp) => {\n      const fetches = new PageRequest(newp, me.options.filterOutgoingRequests);\n      await fetches.addListener;\n\n      const headers = req.headers || {};\n      delete headers['user-agent'];\n      await newp.setExtraHTTPHeaders(headers);\n      await newp.evaluateOnNewDocument(me.options.beforeRender);\n      const resp = await newp.goto(fullUrl, { waitUntil: 'load' });\n      const sRC = me.isHTML(resp);\n      let ret;\n\n      if (sRC) {\n        await fetches.all();\n        process.stdout.write(`Rendering ${fullUrl} with sifrr-seo \\n`);\n        /* istanbul ignore next */\n        await newp.evaluate(me.options.afterRender);\n        /* istanbul ignore next */\n        ret = await newp.evaluate(() => new XMLSerializer().serializeToString(document));\n      } else {\n        ret = false;\n      }\n\n      await newp.close();\n      return ret;\n    });\n  }\n\n  isHTML(puppeteerResp) {\n    return (puppeteerResp.headers()['content-type'] && puppeteerResp.headers()['content-type'].indexOf('html') >= 0);\n  }\n}\n\nmodule.exports = Renderer;\n","const Cache = require('cache-manager');\n\nmodule.exports = (ops) => {\n  ops = Object.assign({\n    cacheStore: 'memory',\n    maxCacheSize: 100, // in MB\n    ttl: 0 // in Seconds\n  }, ops);\n\n  return Cache.caching({\n    store: ops.cacheStore,\n    ttl: ops.ttl,\n    length: (val, key) => {\n      return Buffer.from(key + key + val).length + 2;\n    },\n    max: ops.maxCacheSize * 1000000\n  });\n};","const { headerName, headerValue } = require('./constants');\n\n// this = sifrr seo instance\nmodule.exports = function(req, res, next) {\n  // Don't render other requests than GET\n  if (req.method !== 'GET') return next();\n\n  const renderReq = {\n    fullUrl: this.renderer.options.fullUrl(req),\n    headers: req.headers\n  };\n\n  if (this.getShouldRenderCache(renderReq) === null) {\n    res._end = res.end;\n    res.end = (resp, encoding) => {\n      if (res.hasHeader('content-type')) {\n        const contentType = res.getHeader('content-type');\n        if (contentType.indexOf('html') >= 0) {\n          this.addShouldRenderCache(renderReq, true);\n        } else {\n          this.addShouldRenderCache(renderReq, false);\n        }\n      }\n      res._end(resp, encoding);\n    };\n  }\n\n  return this.render(renderReq).then((html) => {\n    if (html) {\n      res.set(headerName, headerValue);\n      res.send(html);\n    } else next();\n  }).catch((e) => {\n    if (e.message === 'No Render') {\n      global.console.log(`Not rendering for ${renderReq.fullUrl}`);\n      next();\n    } else next(e);\n  });\n};\n","const Renderer = require('./renderer');\nconst isHeadless = new RegExp('(headless|Headless)');\nconst getCache = require('./getcache');\n\nclass SifrrSeo {\n  constructor(userAgents = [\n    'Googlebot', // Google\n    'Bingbot', // Bing\n    'Slurp', // Slurp\n    'DuckDuckBot', // DuckDuckGo\n    'Baiduspider', //Baidu\n    'YandexBot', // Yandex\n    'Sogou', // Sogou\n    'Exabot', // Exalead\n  ], options = {}) {\n    this._uas = userAgents.map((ua) => new RegExp(ua));\n    this.shouldRenderCache = {};\n    this.options = Object.assign({\n      cacheKey: (req) => req.fullUrl,\n      fullUrl: (expressReq) => `http://127.0.0.1:80${expressReq.originalUrl}`\n    }, options);\n  }\n\n  get middleware() {\n    return require('./middleware').bind(this);\n  }\n\n  isHeadless(req) {\n    const ua = req.headers['user-agent'];\n    return !!isHeadless.test(ua);\n  }\n\n  shouldRender(req) {\n    return this.isUserAgent(req);\n  }\n\n  isUserAgent(req) {\n    const ua = req.headers['user-agent'];\n    let ret = false;\n    this._uas.forEach((b) => {\n      if (b.test(ua)) ret = true;\n    });\n    return ret;\n  }\n\n  addUserAgent(userAgent) {\n    this._uas.push(new RegExp(userAgent));\n  }\n\n  clearCache() {\n    this.cache.reset();\n  }\n\n  close() {\n    return this.renderer.close();\n  }\n\n  setPuppeteerOption(name, value) {\n    this._poptions = this._poptions || {};\n    this._poptions[name] = value;\n  }\n\n  get cache() {\n    this._cache = this._cache || getCache(this.options);\n    return this._cache;\n  }\n\n  addShouldRenderCache(req, val) {\n    const key = this.options.cacheKey(req);\n    this.shouldRenderCache[key] = val;\n  }\n\n  getShouldRenderCache(req) {\n    const key = this.options.cacheKey(req);\n    if (this.shouldRenderCache[key] === undefined) return null;\n    return this.shouldRenderCache[key];\n  }\n\n  async render(req) {\n    if (this.getShouldRenderCache(req) === false) {\n      throw Error(`No Render`);\n    } else if (this.shouldRender(req) && !this.isHeadless(req)) {\n      const key = this.options.cacheKey(req);\n      return new Promise((res, rej) => {\n        this.cache.get(key, (err, val) => {\n          /* istanbul ignore if */\n          if (err) {\n            rej(err);\n          } else if (!val) {\n            this.renderer.render(req).then((resp) => {\n              this.cache.set(key, resp);\n              res(resp);\n            }).catch(/* istanbul ignore next */ err => {\n              rej(err);\n            });\n          } else {\n            res(val);\n          }\n        });\n      });\n    } else {\n      throw Error(`No Render`);\n    }\n  }\n\n  get renderer() {\n    this._renderer = this._renderer || new SifrrSeo.Renderer(this._poptions, this.options);\n    return this._renderer;\n  }\n}\n\nSifrrSeo.Renderer = Renderer;\n\nmodule.exports = SifrrSeo;\n"],"names":["require$$0","PageRequest","Cache","global","getCache","Renderer"],"mappings":"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"}